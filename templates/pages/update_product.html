{% extends 'shared/base.html' %}

{% load static %}

{% block title %}Update Product{% endblock %}

{% block content %}
<main>
    <!-- section -->
    <section>
       <!-- container -->
       <div class="container">
          <!-- row -->
          <div class="row">
             <!-- col -->
             <div class="col-12">
                <div class="d-flex justify-content-between align-items-center d-md-none py-4">
                   <!-- heading -->
                   <h3 class="fs-5 mb-0">Update Product</h3>
                   <!-- button -->
                   <button
                      class="btn btn-outline-gray-400 text-muted d-md-none btn-icon btn-sm ms-3"
                      type="button"
                      data-bs-toggle="offcanvas"
                      data-bs-target="#offcanvasAccount"
                      aria-controls="offcanvasAccount">
                      <i class="bi bi-text-indent-left fs-3"></i>
                   </button>
                </div>
             </div>
             <!-- col -->
             {% include 'shared/admin_nav.html' %}
             <div class="col-lg-9 col-md-8 col-12">
                <div class="py-6 p-md-6 p-lg-10">
                   <!-- heading -->
                   <div class="row mb-6">
                    <div class="col d-flex justify-content-between">
                        <h2 class="mb-0">Edit Product: {{ product.name }}</h2>
                    </div>
                </div>

                <form method="POST" enctype="multipart/form-data" action="{% url 'update_product' product.id %}">
                  {% csrf_token %}
                  
                  <div class="row g-3">
                      <div class="col-md-4">
                          <label class="form-label">Name:</label><br>
                          {{ form.name }}
                      </div>
                      
                      <div class="col-md-4">
                          <label class="form-label">Category:</label><br>
                          {{ form.category }}
                      </div>
                      <div class="col-md-4">
                          <label class="form-label">Size:</label><br>
                          {{ form.size }}
                      </div>
                      <div class="col-12">
                          <label class="form-label">Description:</label><br>
                          {{ form.description }}
                      </div>
                      <div class="col-md-4">
                          <label class="form-label">Price:</label><br>
                          {{ form.price }}
                      </div>
                      <div class="col-md-4">
                          <label class="form-label">Condition:</label><br>
                          {{ form.condition }}
                      </div>
                      <!-- Target -->
                      <div class="col-md-4">
                          <label class="form-label">Target:</label><br>
                          {{ form.target }}
                      </div>
              
                      <!-- Section -->
                      <div class="col-md-4">
                          <label class="form-label">Section:</label><br>
                          {{ form.section }}
                      </div>
              
                      <!-- Brand -->
                      <div class="col-md-4">
                          <label class="form-label">Brand:</label><br>
                          {{ form.brand }}
                      </div>
              
                      <!-- Color -->
                      <div class="col-md-4">
                          <label class="form-label">Color:</label><br>
                          {{ form.color }}
                      </div>
              
                      <div class="col-12">
                          <label class="form-label"><strong>Main Image:</strong></label><br>
                          {{ form.image }}
                      </div>
                  </div>
              
                  <hr>
                  <h3>Additional Images</h3>
                  
                  {{ product_image_formset.management_form }}

                    <div class="row">
                        {% for img_form in product_image_formset %}
                            {% if forloop.counter <= 4 %}
                                <div class="col-md-3">
                                    <div style="margin-bottom: 10px;">
                                        <label for="id_{{ img_form.prefix }}_image" class="form-label">Image: {{ forloop.counter }}</label><br>
                                        {{ img_form.image }}
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>

              
                  <div class="mt-3">
                      <button type="submit" class="btn btn-primary" 
                                data-bs-toggle="tooltip" 
                                title="Click to update the product details">
                            <i class="feather-icon icon-edit me-2"></i>
                            Update Product
                        </button>
                  </div>
              </form>
              

               {% if form.errors %}
               <ul style="color: red;">
                  {% for field in form %}
                     {% for error in field.errors %}
                     <li>{{ field.label }}: {{ error }}</li>
                     {% endfor %}
                  {% endfor %}
                  {% for error in form.non_field_errors %}
                     <li>{{ error }}</li>
                  {% endfor %}
               </ul>
               {% endif %}

               {% if product_image_formset.errors %}
               <ul style="color: red;">
                  {% for form in product_image_formset %}
                     {% for error in form.errors.values %}
                     <li>{{ error }}</li>
                     {% endfor %}
                  {% endfor %}
               </ul>
               {% endif %}

                </div>
             </div>
          </div>
       </div>
    </section>
 </main>
{% endblock %}

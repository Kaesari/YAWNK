{% extends 'contests/base.html' %}

{% load static %}

{% block title %}Fantasy Challenge{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- Hero Section -->
    <div class="row align-items-center bg-light p-5 rounded shadow" style="height: 100%;">
        <!-- Text Content -->
        <div class="col-md-6">
            <h1 class="fw-bold text-dark mb-3">Fantasy Challenge. The next adventure for Fantasy Premier League.</h1>
            <p class="text-muted">Play against your friends in season-long leagues to compete to be the best in the world.</p>

            {% if not user.is_authenticated %}
            <div class="d-flex gap-3 mt-4 mb-4">
                <!-- Register Button -->
                <a href="{% url 'register' %}" class="btn btn-primary btn-lg px-4 shadow">Register to play</a>
                <!-- Login Button -->
                <a href="{% url 'login' %}" class="btn btn-outline-dark btn-lg px-4 shadow">Sign in to play</a>
            </div>
            {% endif %}

        </div>
        <!-- Image Content -->
        <div class="header header-banner col-md-6 text-center h-100">
            <img src="{% static 'images/players-banner.png' %}" alt="Fantasy Players" class="img-fluid rounded h-100 w-100 object-fit-cover">
        </div>
    </div>

    {% if user.is_authenticated %}
    <!-- Add the fixtures section below -->
    <div class="mt-4 bg-light rounded p-3">
        <h4 class="text-center fw-bold text-uppercase mb-3">Gameweek 21 Fixtures</h4>
        <p class="text-center text-muted">Final Deadline <strong>Thu 16 Jan 23:00</strong></p>
        <div class="text-center mb-3">
            <button class="btn btn-primary">Deadlines explained</button>
        </div>
        <h5 class="fw-bold text-dark">Tuesday 14 January 2025</h5>
        <div class="timeline mt-3">
            <!-- Match 1 -->
            <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                <div class="me-2 text-center">
                    <span class="fw-bold">22:30</span>
                    <p class="text-muted small">Next deadline</p>
                </div>
                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                    <div class="d-flex align-items-center me-3">
                        <img src="{% static 'images/brentford.png' %}" alt="Brentford" class="img-fluid"
                            style="height: 24px; width: 24px; margin-right: 8px;">
                        <span>Brentford</span>
                    </div>
                    <span class="fw-bold mx-3">22:30</span>
                    <div class="d-flex align-items-center ms-3">
                        <span>Man City</span>
                        <img src="{% static 'images/man_city.png' %}" alt="Man City" class="img-fluid"
                            style="height: 24px; width: 24px; margin-left: 8px;">
                    </div>
                </div>
                <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                    style="height: 24px;">
            </div>

            <!-- Match 2 -->
            <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                <div class="me-2 text-center">
                    <span class="fw-bold">22:30</span>
                    <p class="text-muted small">Next deadline</p>
                </div>
                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                    <div class="d-flex align-items-center me-3">
                        <img src="{% static 'images/chelsea.png' %}" alt="Chelsea" class="img-fluid"
                            style="height: 24px; width: 24px; margin-right: 8px;">
                        <span>Chelsea</span>
                    </div>
                    <span class="fw-bold mx-3">22:30</span>
                    <div class="d-flex align-items-center ms-3">
                        <span>Bournemouth</span>
                        <img src="{% static 'images/bournemouth.png' %}" alt="Bournemouth" class="img-fluid"
                            style="height: 24px; width: 24px; margin-left: 8px;">
                    </div>
                </div>
                <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                    style="height: 24px;">
            </div>

            <!-- Match 3 -->
            <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                <div class="me-2 text-center">
                    <span class="fw-bold">22:30</span>
                    <p class="text-muted small">Next deadline</p>
                </div>
                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                    <div class="d-flex align-items-center me-3">
                        <img src="{% static 'images/west_ham.png' %}" alt="West Ham" class="img-fluid"
                            style="height: 24px; width: 24px; margin-right: 8px;">
                        <span>West Ham</span>
                    </div>
                    <span class="fw-bold mx-3">22:30</span>
                    <div class="d-flex align-items-center ms-3">
                        <span>Fulham</span>
                        <img src="{% static 'images/fulham.png' %}" alt="Fulham" class="img-fluid"
                            style="height: 24px; width: 24px; margin-left: 8px;">
                    </div>
                </div>
                <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                    style="height: 24px;">
            </div>

            <!-- Match 4 -->
            <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                <div class="me-2 text-center">
                    <span class="fw-bold">22:30</span>
                    <p class="text-muted small">Next deadline</p>
                </div>
                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                    <div class="d-flex align-items-center me-3">
                        <img src="{% static 'images/nottm_forest.png' %}" alt="Nott'm Forest" class="img-fluid"
                            style="height: 24px; width: 24px; margin-right: 8px;">
                        <span>Nott'm Forest</span>
                    </div>
                    <span class="fw-bold mx-3">22:30</span>
                    <div class="d-flex align-items-center ms-3">
                        <span>Liverpool</span>
                        <img src="{% static 'images/liverpool.png' %}" alt="Liverpool" class="img-fluid"
                            style="height: 24px; width: 24px; margin-left: 8px;">
                    </div>
                </div>
                <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                    style="height: 24px;">
            </div>

            <!-- Match 5 -->
            <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                <div class="me-2 text-center">
                    <span class="fw-bold">22:30</span>
                    <p class="text-muted small">Next deadline</p>
                </div>
                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                    <div class="d-flex align-items-center me-3">
                        <img src="{% static 'images/everton.png' %}" alt="Everton" class="img-fluid"
                            style="height: 24px; width: 24px; margin-right: 8px;">
                        <span>Everton</span>
                    </div>
                    <span class="fw-bold mx-3">22:30</span>
                    <div class="d-flex align-items-center ms-3">
                        <span>Aston Villa</span>
                        <img src="{% static 'images/aston_villa.png' %}" alt="Aston Villa" class="img-fluid"
                            style="height: 24px; width: 24px; margin-left: 8px;">
                    </div>
                </div>
                <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                    style="height: 24px;">
            </div>

            <!-- Match 6 -->
            <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                <div class="me-2 text-center">
                    <span class="fw-bold">22:30</span>
                    <p class="text-muted small">Next deadline</p>
                </div>
                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                    <div class="d-flex align-items-center me-3">
                        <img src="{% static 'images/leicester.png' %}" alt="Leicester" class="img-fluid"
                            style="height: 24px; width: 24px; margin-right: 8px;">
                        <span>Leicester</span>
                    </div>
                    <span class="fw-bold mx-3">22:30</span>
                    <div class="d-flex align-items-center ms-3">
                        <span>Crystal Palace</span>
                        <img src="{% static 'images/crystal_palace.png' %}" alt="Crystal Palace"
                            class="img-fluid" style="height: 24px; width: 24px; margin-left: 8px;">
                    </div>
                </div>
                <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                    style="height: 24px;">
            </div>
        </div>
    </div>
    {% else %}
    <!-- Login Section -->
    <div class="row bg-white mt-5 p-5 rounded shadow-sm">
        <form method="post" action="{% url 'login' %}">
            {% csrf_token %}
            <div class="d-flex align-items-center justify-content-between w-100">
                <!-- Login Title -->
                <div class="col-md-2 text-center">
                    <h3 class="fw-bold text-dark">Login</h3>
                </div>

                <!-- Email Input -->
                <div class="col-md-2">
                    <input type="text" name="username" id="email" class="form-control form-control-lg border-0 shadow-sm" placeholder="Email or Username" required>
                </div>

                <!-- Password Input -->
                <div class="col-md-2">
                    <input type="password" name="password" id="password" class="form-control form-control-lg border-0 shadow-sm" placeholder="Password" required>
                </div>

                <!-- Sign In Button -->
                <div class="col-md-2">
                    <button type="submit" class="btn btn-success btn-lg w-100 shadow">Sign in</button>
                </div>

                <!-- Forgot Password Link {% url 'password_reset' %}-->
                <div class="col-md-2 text-center">
                    <a href="" class="text-primary fw-bold">Forgot password? ></a>
                </div>
            </div>
        </form>
    
        <!-- Divider -->
        <div class="col-12 text-center mt-4 mb-3">
            <div class="d-flex align-items-center justify-content-center">
                <hr class="flex-grow-1 border-secondary">
                <span class="mx-3 text-muted">Or you can</span>
                <hr class="flex-grow-1 border-secondary">
            </div>
        </div>

        <!-- Social Login Options -->
        <div class="col-12 d-flex flex-wrap justify-content-center gap-3">
            <a href="#" class="btn btn-create-account btn-lg shadow"><i class="fas fa-user-plus me-2"></i>Create a free account</a>
            <a href="#" class="btn btn-facebook btn-lg shadow"><i class="fab fa-facebook-f me-2"></i>Login with Facebook</a>
            <a href="#" class="btn btn-dark btn-lg shadow"><i class="fab fa-twitter me-2"></i>Login with X</a>
            <a href="#" class="btn btn-google btn-lg shadow"><i class="fab fa-google me-2"></i>Login with Google</a>
            <a href="#" class="btn btn-black btn-lg shadow"><i class="fab fa-apple me-2"></i>Login with Apple</a>
        </div>
    </div>
    {% endif %}
    
</div>
{% endblock %}












<!-- -----------------------------------------------------------------Teams -->

{% extends 'contests/base.html' %}

{% load static %}

{% block title %}Team Selection{% endblock %}

{% block content %}
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1050;" id="toastContainer">
</div>

<!-- Modal -->
<div id="leagueOptionsModal" class="modal fade" tabindex="-1" aria-labelledby="leagueOptionsModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"> <!-- Centered modal -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="leagueOptionsModalLabel">What would you like to do next?</h5>
                <button type="button" class="btn-close" id="dismissButton" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>You can either create a new league and invite your friends or join an existing league to compete.</p>
            </div>
            <div class="modal-footer">
                <a href="/api/create-league/" class="btn btn-primary"
                    style="background: linear-gradient(to right, #00ffc6, #007bff); color: white;">Create League</a>
                <a href="/api/league/" class="btn btn-secondary">Join League</a>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    <!-- Card Container -->
    <div class="p-4 rounded shadow-sm" style="background: linear-gradient(to right, #00ffc6, #007bff); color: white;">
        <!-- Card Content -->
        <div class="row row-cols-1 row-cols-md-2 g-4"> <!-- Bootstrap responsive classes for gaps -->
            <!-- Left Section -->
            <div class="col">
                <div class="rounded p-4 d-flex flex-column h-100"
                    style="background: linear-gradient(to left, #00ffc6, #007bff); min-height: 200px;">

                    <!-- Image and Text -->
                    <div class="d-flex align-items-center flex-nowrap">
                        <img src="{% static 'images/gaolpost-1.png' %}" alt="Goal Post" class="me-3"
                            style="width: 60px; height: 60px; border-radius: 50%;">
                        <div>
                            <h3 class="fw-bold mb-1 text-dark">{{ user_team.name }}</h3>
                            <h3 class="fw-bold mb-1 text-dark" id="teamName" style="display: none;">{{ user_team.name
                                }}#{{ user_team.id }}</h3>
                            <p class="fw-bold mb-2 text-dark" style="font-size: 0.8rem;">{{ user_team.user.username }}
                            </p>
                        </div>
                    </div>

                    <!-- Total Points and Global Ranking -->
                    <div class="bg-dark text-white rounded p-3 mt-auto"> <!-- Added mt-auto to push content down -->
                        <div class="row d-flex align-items-center">
                            <!-- Total Points Section -->
                            <div class="col-4 text-center d-flex flex-column align-items-center justify-content-center">
                                <h1 class="fw-bold mb-0">0</h1> <!-- Added mb-0 for tighter spacing -->
                                <p class="text-muted">Total Points</p>
                            </div>
                            <!-- Global Rank and Highest Points Section -->
                            <div class="col-8">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Global rank</span>
                                    <span>-</span>
                                </div>
                                <hr class="fade-hr my-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Highest points</span>
                                    <span>-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Right Section -->
            <div class="col">
                <div class="rounded p-4 d-flex flex-column h-100"
                    style="background: linear-gradient(to left, #00ffc6, #007bff); min-height: 200px;">
                    <h4 class="fw-bold  text-dark" style="font-size: 1.0rem;">Gameweek 21 Challenge</h4>
                    <h5 class="fw-bold  text-dark">Legends</h5>
                    <p class="text-dark">âš¡ Players who have been at their club for 5+ seasons earn double points</p>
                    <div class="d-flex justify-content-between mt-auto"> <!-- Added mt-auto to align inner boxes -->
                        <div class="p-3 rounded shadow-sm d-flex justify-content-between align-items-center"
                            style="background-color: #e8fff4; width: 100%; opacity: 0.8;">
                            <span class="text-dark" style="font-size: 0.8rem;">Players selected</span>
                            <div>
                                <span class="fw-bold text-dark">
                                    <span id="budgetDisplay">100.0m</span>
                                    <span class="text-dark" style="font-size: 0.8rem;">Remaining budget</span>
                                </span>
                            </div>

                            <span class="fw-bold text-dark">Unlimited</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div id="playerModal" class="modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
            <div class="modal-content"
                style="background: linear-gradient(to right, #00ffc6, #007bff); width: 90%; max-width: 600px; margin: 10% auto; padding: 20px; border-radius: 15px; color: white; text-align: center; position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">

                <!-- Close Button -->
                <button id="closeModalButton"
                    style="position: absolute; top: 10px; right: 20px; background: transparent; color: white; border: none; font-size: 1.5rem; cursor: pointer;">
                    X
                </button>

                <!-- Player Information -->
                <div class="d-flex align-items-center" style="flex-direction: column;">
                    <!-- Player Image -->
                    <img id="modalPlayerImage" src="" alt=""
                        style="width: 120px; height: 120px; border-radius: 50%; margin-bottom: 20px;">
                    <!-- Player Name and Position -->
                    <h3 id="modalPlayerName" style="margin: 0; font-size: 1.5rem;"></h3>
                    <p id="modalPlayerPosition" style="margin: 0; font-size: 1rem;">Midfielder</p>
                    <!-- Player Team -->
                    <p id="modalPlayerTeam" style="font-size: 1rem; color: #f9e000;">Brentford</p>
                </div>

                <!-- Stats Section -->
                <div class="d-flex justify-content-between align-items-center"
                    style="margin: 20px 0; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">Price</p>
                        <h4 id="modalPlayerPrice" style="margin: 5px 0;">7.8m</h4>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">Form</p>
                        <h4 id="modalPlayerForm" style="margin: 5px 0;">8.0</h4>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">TSB%</p>
                        <h4 id="modalPlayerTSB" style="margin: 5px 0;">5.43%</h4>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex justify-content-around">
                    <button class="btn btn-light"
                        style="padding: 10px 20px; border-radius: 20px; font-weight: bold; background: #1dcdfd; color: white; border: none;">
                        Make Captain
                    </button>
                    <button class="btn btn-light"
                        style="padding: 10px 20px; border-radius: 20px; font-weight: bold; background: #8e44ad; color: white; border: none;">
                        Transfer Out
                    </button>
                </div>
            </div>
        </div>


        <!-- Pitch Area bg-success -->
        <div class="col-md-8">
            <div class="position-relative rounded">
                <img src="{% static 'images/pitch.png' %}" alt="Pitch" class="img-fluid w-100 rounded">
                <div id="pitch-formation">
                    <!-- Formation players will be dynamically injected here -->
                </div>
            </div>
            <!-- Button Section -->
            <div class="container mt-3">
                <div class="row g-3 justify-content-center align-items-center">
                    <!-- Formation Dropdown -->
                    <div class="col-12 col-md-auto d-flex align-items-center bg-light border rounded p-3">
                        <label for="formation-select" style="font-size: 16px; margin-right: 8px;">Choose
                            formation</label>
                        <select id="formation-select" class="form-select form-select-lg" style="width: 150px;">
                            <option value="1-1-2">1-1-2</option>
                            <option value="4-4-2">4-4-2</option>
                            <option value="4-3-3">4-3-3</option>
                            <option value="3-5-2">3-5-2</option>
                            <option value="5-3-2">5-3-2</option>
                        </select>
                    </div>

                    <!-- Buttons -->
                    <div class="col-12 col-md-auto">
                        <button id="resetButton" class="btn btn-outline-secondary btn-lg w-100 mb-2 mb-md-0"
                            style="padding: 10px 20px;">Reset</button>
                    </div>
                    <div class="col-12 col-md-auto">
                        <button class="btn btn-outline-secondary btn-lg w-100 mb-2 mb-md-0" id="autoPickButton"
                            style="padding: 10px 20px;">
                            Auto pick
                        </button>
                    </div>
                    <div class="col-12 col-md-auto">
                        <button id="saveTeamButton" class="btn btn-primary btn-lg w-100"
                            style="background: linear-gradient(to right, #00ffc6, #007bff); color: rgb(255, 255, 255); padding: 10px 30px;">Save
                            team</button>
                    </div>

                </div>
            </div>
            <!-- Add the fixtures section below -->
            <div class="mt-4 bg-light rounded p-3">
                <h4 class="text-center fw-bold text-uppercase mb-3">Gameweek 21 Fixtures</h4>
                <p class="text-center text-muted">Final Deadline <strong>Thu 16 Jan 23:00</strong></p>
                <div class="text-center mb-3">
                    <button class="btn btn-primary">Deadlines explained</button>
                </div>
                <h5 class="fw-bold text-dark">Tuesday 14 January 2025</h5>
                <div class="timeline mt-3">
                    <!-- Match 1 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/brentford.png' %}" alt="Brentford" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Brentford</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Man City</span>
                                <img src="{% static 'images/man_city.png' %}" alt="Man City" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 2 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/chelsea.png' %}" alt="Chelsea" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Chelsea</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Bournemouth</span>
                                <img src="{% static 'images/bournemouth.png' %}" alt="Bournemouth" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 3 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/west_ham.png' %}" alt="West Ham" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>West Ham</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Fulham</span>
                                <img src="{% static 'images/fulham.png' %}" alt="Fulham" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 4 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/nottm_forest.png' %}" alt="Nott'm Forest" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Nott'm Forest</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Liverpool</span>
                                <img src="{% static 'images/liverpool.png' %}" alt="Liverpool" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 5 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/everton.png' %}" alt="Everton" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Everton</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Aston Villa</span>
                                <img src="{% static 'images/aston_villa.png' %}" alt="Aston Villa" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 6 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/leicester.png' %}" alt="Leicester" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Leicester</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Crystal Palace</span>
                                <img src="{% static 'images/crystal_palace.png' %}" alt="Crystal Palace"
                                    class="img-fluid" style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>
                </div>
            </div>

            <!-- Fixtures Section -->
            <div class="mt-4 bg-light rounded p-3">
                <h4 class="text-center fw-bold text-uppercase mb-3">Gameweek Fixtures</h4>
                <p class="text-center text-muted">Real-Time Matches</p>
                <div class="timeline mt-3">
                    {% for match in matches %}
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">{{ match.formatted_time }}</span>
                            <p class="text-muted small">{{ match.formatted_date }}</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{{ match.homeTeam.logo }}" alt="{{ match.homeTeam.name }}" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>{{ match.homeTeam.name }}</span>
                            </div>
                            <span class="fw-bold mx-3">vs</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>{{ match.awayTeam.name }}</span>
                                <img src="{{ match.awayTeam.logo }}" alt="{{ match.awayTeam.name }}" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Player Selection -->
        <div class="col-md-4">
            <div class="bg-white p-4 rounded shadow-sm">
                <h5 class="fw-bold">Player Selection</h5>
                <input type="text" class="form-control mb-3" placeholder="Search for player...">
                <select class="form-select mb-3">
                    <option>View</option>
                    <option>Defenders</option>
                    <option>Midfielders</option>
                </select>
                <select class="form-select mb-3">
                    <option>Sorted by</option>
                    <option>Total points</option>
                    <option>Price</option>
                </select>
                <p class="fw-bold mb-1">Max cost: Between 3.9 and 7.2</p>
                <div class="d-flex justify-content-between">
                    <span>7.2</span>
                    <input type="range" class="form-range">
                </div>
                <div class="form-check mt-3">
                    <input class="form-check-input" type="checkbox" id="fiveSeasons">
                    <label class="form-check-label" for="fiveSeasons">
                        Show Players who have been at their club for 5+ seasons
                    </label>
                </div>
                <button class="btn btn-primary w-100 mt-3">207 players shown</button>

                <!-- Goalkeepers Section -->
                <h5 class="fw-bold text-dark mt-4">Goalkeepers</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="Aaron Ramsdale"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Goalkeeper">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Aaron Ramsdale</span><br>
                                        <small class="text-muted">ARS GKP</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">123</td>
                            <td class="fw-bold text-center">20.5m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="David Raya"
                            data-image="{% static 'images/palmer.png' %}" data-position="Goalkeeper">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">David Raya</span><br>
                                        <small class="text-muted">ARS GKP</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-warning">MCI (A)</span></td>
                            <td class="text-center">97</td>
                            <td class="fw-bold text-center">40.0m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Defenders Section -->
                <h5 class="fw-bold text-dark mt-4">Defenders</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="William Saliba"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Defender">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">William Saliba</span><br>
                                        <small class="text-muted">ARS DEF</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-danger">LIV (A)</span></td>
                            <td class="text-center">110</td>
                            <td class="fw-bold text-center">50.2m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="Oleksandr Zinchenko"
                            data-image="{% static 'images/palmer.png' %}" data-position="Defender">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Oleksandr Zinchenko</span><br>
                                        <small class="text-muted">ARS DEF</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">102</td>
                            <td class="fw-bold text-center">52.0m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Midfielders Section -->
                <h5 class="fw-bold text-dark mt-4">Midfielders</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="Martin Degaard"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Midfielder">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Martin Degaard</span><br>
                                        <small class="text-muted">ARS MID</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-warning">MUN (H)</span></td>
                            <td class="text-center">140</td>
                            <td class="fw-bold text-center">6.8m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="Bukayo Saka"
                            data-image="{% static 'images/palmer.png' %}" data-position="Midfielder">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Bukayo Saka</span><br>
                                        <small class="text-muted">ARS MID</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">152</td>
                            <td class="fw-bold text-center">8.3m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Forwards Section -->
                <h5 class="fw-bold text-dark mt-4">Forwards</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="Gabriel Jesus"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Forward">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Gabriel Jesus</span><br>
                                        <small class="text-muted">ARS FWD</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-warning">MUN (H)</span></td>
                            <td class="text-center">87</td>
                            <td class="fw-bold text-center">8.0m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="Eddie Nketiah"
                            data-image="{% static 'images/palmer.png' %}" data-position="Forward">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Eddie Nketiah</span><br>
                                        <small class="text-muted">ARS FWD</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">65</td>
                            <td class="fw-bold text-center">6.4m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Pagination Controls -->
                <div class="d-flex justify-content-between align-items-center mt-4">
                    <span>1 of 20</span>
                    <div>
                        <button class="btn btn-light me-2"><i class="fas fa-chevron-left"></i></button>
                        <button class="btn btn-light"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

<!-- Auto Pitch -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Define formations and their respective positions
        const formations = {
            "1-1-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "45%", left: "50%" },
                { position: "Midfielder", top: "77%", left: "32%" },
                { position: "Midfielder", top: "77%", left: "67%" },
            ],
            "4-4-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "25%", left: "20%" },
                { position: "Defender", top: "25%", left: "40%" },
                { position: "Defender", top: "25%", left: "60%" },
                { position: "Defender", top: "25%", left: "80%" },
                { position: "Midfielder", top: "50%", left: "20%" },
                { position: "Midfielder", top: "50%", left: "40%" },
                { position: "Midfielder", top: "50%", left: "60%" },
                { position: "Midfielder", top: "50%", left: "80%" },
                { position: "Forward", top: "77%", left: "32%" },
                { position: "Forward", top: "77%", left: "67%" },
            ],
        };

        // Define available players with prices
        const players = [
            { name: "Aaron Ramsdale", position: "Goalkeeper", price: 4.5, image: "{% static 'images/m_salah.png' %}" },
            { name: "David Raya", position: "Goalkeeper", price: 4.8, image: "{% static 'images/m_salah.png' %}" },
            { name: "Ben White", position: "Defender", price: 5.0, image: "{% static 'images/m_salah.png' %}" },
            { name: "William Saliba", position: "Defender", price: 5.5, image: "{% static 'images/m_salah.png' %}" },
            { name: "Oleksandr Zinchenko", position: "Defender", price: 5.2, image: "{% static 'images/m_salah.png' %}" },
            { name: "Gabriel Magalhaes", position: "Defender", price: 5.0, image: "{% static 'images/m_salah.png' %}" },
            { name: "Martin Degaard", position: "Midfielder", price: 6.8, image: "{% static 'images/m_salah.png' %}" },
            { name: "Declan Rice", position: "Midfielder", price: 5.9, image: "{% static 'images/m_salah.png' %}" },
            { name: "Bukayo Saka", position: "Forward", price: 8.3, image: "{% static 'images/m_salah.png' %}" },
            { name: "Gabriel Jesus", position: "Forward", price: 8.0, image: "{% static 'images/m_salah.png' %}" },
        ];

        const formationSelect = document.getElementById("formation-select");
        const pitchFormation = document.getElementById("pitch-formation");
        const autoPickButton = document.getElementById("autoPickButton");
        const budgetDisplay = document.getElementById("budgetDisplay");

        let totalBudget = 100.0; // Total available budget
        let remainingBudget = totalBudget; // Remaining budget

        // Update the budget display
        function updateBudgetDisplay() {
            budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
        }

        // Function to render a formation
        function renderFormation(formationKey) {
            pitchFormation.innerHTML = ""; // Clear the pitch
            const formation = formations[formationKey];

            if (formation) {
                formation.forEach((position) => {
                    const positionDiv = document.createElement("div");
                    positionDiv.className = "position-absolute text-center";
                    positionDiv.style.top = position.top;
                    positionDiv.style.left = position.left;
                    positionDiv.style.transform = "translate(-50%, -50%)";
                    positionDiv.innerHTML = `
                    <div class="bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center" 
                        style="width: 50px; height: 50px;">
                        ${position.position}
                    </div>
                `;
                    pitchFormation.appendChild(positionDiv);
                });
            }
        }

        // Auto-pick players while considering the budget
        function autoPickPlayers(formationKey) {
            const formation = formations[formationKey];
            if (!formation) {
                console.error("Formation not found:", formationKey);
                return;
            }

            const shuffledPlayers = [...players].sort(() => 0.5 - Math.random());
            remainingBudget = totalBudget; // Reset budget
            updateBudgetDisplay(); // Update budget display
            pitchFormation.innerHTML = ""; // Clear the pitch

            formation.forEach((position) => {
                const player = shuffledPlayers.find((p) => p.position === position.position && p.price <= remainingBudget);
                if (player) {
                    const playerDiv = document.createElement("div");
                    playerDiv.className = "position-absolute text-center";
                    playerDiv.style.top = position.top;
                    playerDiv.style.left = position.left;
                    playerDiv.style.transform = "translate(-50%, -50%)";

                    playerDiv.innerHTML = `
                        <div class="rounded text-center shadow-sm player-card" 
                            style="width: 50px;  font-family: Arial, sans-serif; cursor: pointer;"  
                            data-name="${player.name}" 
                            data-image="${player.image}" 
                            data-position="${player.position}" 
                            data-price="${player.price}">

                            <div class="bg-success d-flex justify-content-center align-items-center" style="padding-top: 5px;border-top-left-radius: 10px; border-top-right-radius: 10px; padding: 5px;">
                                <img src="${player.image}" alt="${player.name.split(" ")[0]}" 
                                    style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                            </div>

                            <div class="bg-light" 
                                style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                                ${player.name.split(" ")[0]}
                            </div>

                        </div>
                    `;

                    // Add click event to open the modal
                    playerDiv.querySelector(".player-card").addEventListener("click", function () {
                        showPlayerModal(
                            this.getAttribute("data-name"),
                            this.getAttribute("data-image"),
                            this.getAttribute("data-position")
                        );
                    });

                    pitchFormation.appendChild(playerDiv);

                    // Deduct the player's price from the budget
                    remainingBudget -= player.price;
                    updateBudgetDisplay();
                }
            });
        }

        function showPlayerModal(name, image, position) {
            const modal = document.getElementById("playerModal");
            document.getElementById("modalPlayerName").textContent = name;
            document.getElementById("modalPlayerImage").src = image;
            document.getElementById("modalPlayerPosition").textContent = position;
            modal.style.display = "block";
        }

        document.getElementById("closeModalButton").addEventListener("click", function () {
            document.getElementById("playerModal").style.display = "none";
        });

        document.getElementById("playerModal").addEventListener("click", function (e) {
            if (e.target === this) {
                this.style.display = "none";
            }
        });

        // Event listener for formation dropdown change
        formationSelect.addEventListener("change", function () {
            renderFormation(this.value);
        });

        // Event listener for Auto-Pick button
        autoPickButton.addEventListener("click", function () {
            autoPickPlayers(formationSelect.value); // Trigger auto-pick based on the current formation
        });

        // Render default formation on load
        renderFormation("1-1-2");
        updateBudgetDisplay(); // Initialize budget display
    });

</script>

<!-- Manual $ Reset -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const formations = {
            "1-1-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "45%", left: "50%" },
                { position: "Midfielder", top: "77%", left: "32%" },
                { position: "Midfielder", top: "77%", left: "67%" },
            ],
            "4-4-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "25%", left: "20%" },
                { position: "Defender", top: "25%", left: "40%" },
                { position: "Defender", top: "25%", left: "60%" },
                { position: "Defender", top: "25%", left: "80%" },
                { position: "Midfielder", top: "50%", left: "20%" },
                { position: "Midfielder", top: "50%", left: "40%" },
                { position: "Midfielder", top: "50%", left: "60%" },
                { position: "Midfielder", top: "50%", left: "80%" },
                { position: "Forward", top: "77%", left: "32%" },
                { position: "Forward", top: "77%", left: "67%" },
            ],
        };

        const pitchFormation = document.getElementById("pitch-formation");
        const formationSelect = document.getElementById("formation-select");
        const resetButton = document.getElementById("resetButton");
        const playerSelectionRows = document.querySelectorAll(".player-selection-row");

        const maxBudget = 100; // Example budget in millions
        let remainingBudget = maxBudget; // Track the remaining budget
        let currentTotalPrice = 0; // Track the total price of added players

        let selectedPositionElement = null; // Track the currently selected position

        // Function to render a formation
        function renderFormation(formationKey) {
            pitchFormation.innerHTML = ""; // Clear the pitch
            const formation = formations[formationKey];

            if (formation) {
                formation.forEach((position, index) => {
                    const positionDiv = document.createElement("div");
                    positionDiv.className = "pitch-position position-absolute text-center";
                    positionDiv.style.top = position.top;
                    positionDiv.style.left = position.left;
                    positionDiv.style.transform = "translate(-50%, -50%)";
                    positionDiv.setAttribute("data-index", index);

                    positionDiv.innerHTML = `
                    <div class="bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center" 
                        style="width: 50px; height: 50px; cursor: pointer;">
                        ${position.position}
                    </div>
                `;

                    // Event listener for manual assignment
                    positionDiv.addEventListener("click", function () {
                        selectedPositionElement = positionDiv; // Store the clicked position
                        highlightPosition(selectedPositionElement);
                    });

                    pitchFormation.appendChild(positionDiv);
                });
            }
        }

        // Highlight the selected position
        function highlightPosition(positionDiv) {
            document.querySelectorAll(".pitch-position").forEach((div) => {
                div.style.border = ""; // Reset border for all positions
            });
            if (positionDiv) {
                positionDiv.style.border = "2px dashed green"; // Highlight the selected position Remaining Budget: Ksh
            }
        }

        // Update the displayed budget
        function updateBudgetDisplay() {
            const budgetDisplay = document.getElementById("budgetDisplay");
            budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
        }

        // Assign a player to the selected position
        function assignPlayerToPosition(player, price) {
            if (!selectedPositionElement) {
                showToast("Please select a position on the pitch first!", "danger");
                return;
            }

            if (price > remainingBudget) {
                showToast("Insufficient budget to add this player!", "danger");
                return;
            }

            if (currentTotalPrice + price > maxBudget) {
                showToast("Adding this player exceeds the total budget!", "danger");
                return;
            }

            // Deduct the player's price from the remaining budget and add to the total price
            remainingBudget -= price;
            currentTotalPrice += price;
            updateBudgetDisplay();

            selectedPositionElement.innerHTML = `
            <div class="rounded text-center shadow-sm player-card" 
                style="width: 50px; font-family: Arial, sans-serif; cursor: pointer;"
                data-name="${player.name}"
                data-image="${player.image}"
                data-position="${player.position}"
                data-price="${price}">

                <div class="bg-success d-flex justify-content-center align-items-center" 
                    style="padding: 5px; border-top-left-radius: 10px; border-top-right-radius: 10px;">
                    <img src="${player.image}" alt="${player.name}" 
                        style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                </div>
                <div class="bg-light" 
                    style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; 
                    border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                    ${player.name.split(" ")[0]}
                </div>
            </div>
        `;

            // Add click event to the new player card for modal functionality
            selectedPositionElement.querySelector(".player-card").addEventListener("click", function (e) {
                e.stopPropagation(); // Prevent event bubbling
                showPlayerModal(player.name, player.image, player.position);
            });

            highlightPosition(null); // Reset the highlight
            selectedPositionElement = null; // Clear selected position
        }

        // Show modal with player details
        function showPlayerModal(name, image, position) {
            const modal = document.getElementById("playerModal");
            document.getElementById("modalPlayerName").textContent = name;
            document.getElementById("modalPlayerImage").src = image;
            document.getElementById("modalPlayerPosition").textContent = position;
            modal.style.display = "block";
        }

        // Close the modal
        document.getElementById("closeModalButton").addEventListener("click", function () {
            document.getElementById("playerModal").style.display = "none";
        });

        document.getElementById("playerModal").addEventListener("click", function (e) {
            if (e.target === this) {
                this.style.display = "none";
            }
        });

        // Attach event listeners to player selection rows
        playerSelectionRows.forEach((row) => {
            row.addEventListener("click", function () {
                const player = {
                    name: this.getAttribute("data-name"),
                    image: this.getAttribute("data-image"),
                    position: this.getAttribute("data-position"),
                };

                const priceText = this.querySelector("td:nth-child(4)").textContent.trim(); // Extract price from 4th column
                const price = parseFloat(priceText.replace("m", ""));

                assignPlayerToPosition(player, price);
            });
        });

        // Reset button event listener
        resetButton.addEventListener("click", function () {
            renderFormation(formationSelect.value); // Re-render formation without players
            remainingBudget = maxBudget; // Reset budget
            currentTotalPrice = 0; // Reset total price
            updateBudgetDisplay();
        });

        // Event listener for formation dropdown change
        formationSelect.addEventListener("change", function () {
            renderFormation(this.value);
        });

        // Render default formation on load
        renderFormation("1-1-2");

        // Initialize budget display
        updateBudgetDisplay();
    });

</script>

<!-- Showing Toast -->
<script>
    function showToast(message, type = "danger") {
        const toastContainer = document.getElementById("toastContainer");

        // Create the toast element
        const toast = document.createElement("div");
        toast.className = `toast align-items-center text-white bg-${type} border-0`;
        toast.setAttribute("role", "alert");
        toast.setAttribute("aria-live", "assertive");
        toast.setAttribute("aria-atomic", "true");
        toast.setAttribute("data-bs-autohide", "true");
        toast.setAttribute("data-bs-delay", "3000");

        // Add the toast content
        toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    `;

        // Append the toast to the container
        toastContainer.appendChild(toast);

        // Initialize the toast using Bootstrap's JS
        const bootstrapToast = new bootstrap.Toast(toast);
        bootstrapToast.show();

        // Remove the toast from the DOM after it hides
        toast.addEventListener("hidden.bs.toast", () => {
            toast.remove();
        });
    }

</script>

<!-- Team Saving -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const saveTeamButton = document.getElementById("saveTeamButton");

        // Fetch team status on page load
        fetch("/api/check-team-status/", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((response) => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error("Failed to fetch team status.");
            })
            .then((data) => {
                if (data.team_exists) {
                    // Disable the save button if the team already exists
                    saveTeamButton.disabled = true;
                    saveTeamButton.textContent = "Team Saved";
                    saveTeamButton.classList.add("btn-secondary"); // Optional: Update button styling
                    saveTeamButton.classList.remove("btn-primary");

                    // Disable the Auto Pick and Reset buttons
                    autoPickButton.disabled = true;
                    autoPickButton.classList.add("btn-secondary"); // Optional: Update styling
                    autoPickButton.classList.remove("btn-outline-secondary");

                    resetButton.disabled = true;
                    resetButton.classList.add("btn-secondary"); // Optional: Update styling
                    resetButton.classList.remove("btn-outline-secondary");
                }
            })
            .catch((error) => {
                console.error("Error fetching team status:", error);
            });

        // Save Team Button Event Listener
        saveTeamButton.addEventListener("click", function () {
            const pitchPositions = document.querySelectorAll(".position-absolute .player-card");
            const teamData = [];
            const teamName = document.getElementById("teamName").textContent.trim();

            pitchPositions.forEach((playerCard) => {
                if (playerCard) {
                    const positionContainer = playerCard.parentElement; // Get parent container (position-absolute)
                    const positionCoordinates = {
                        top: positionContainer.style.top,
                        left: positionContainer.style.left,
                    };

                    const playerData = {
                        name: playerCard.getAttribute("data-name"),
                        position: playerCard.getAttribute("data-position"),
                        team: playerCard.getAttribute("data-team") || "Unknown",
                        formation_name: document.getElementById("formation-select").value,
                        score: parseInt(playerCard.getAttribute("data-score") || "0"),
                        position_coordinates: JSON.stringify(positionCoordinates), // Add coordinates as JSON string
                    };
                    teamData.push(playerData);
                }
            });


            if (teamData.length === 0) {
                showToast("No players selected to save.", "danger");
                return;
            }

            // Send the team data to the backend
            fetch("/api/save-team/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": getCSRFToken(),
                },
                body: JSON.stringify({ team_name: teamName, team: teamData }), // Ensure payload matches backend expectation
            })
                .then((response) => {
                    // console.log("Response status:", response.status); // Debug log
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error("Failed to save team.");
                })
                .then((data) => {
                    // Show success toast and disable button
                    showToast(data.message || "Team saved successfully!", "success");
                    saveTeamButton.disabled = true;
                    saveTeamButton.textContent = "Team Saved";
                    saveTeamButton.classList.add("btn-secondary");
                    saveTeamButton.classList.remove("btn-primary");

                    // Disable the Auto Pick and Reset buttons
                    autoPickButton.disabled = true;
                    autoPickButton.classList.add("btn-secondary"); // Optional: Update styling
                    autoPickButton.classList.remove("btn-outline-secondary");

                    resetButton.disabled = true;
                    resetButton.classList.add("btn-secondary"); // Optional: Update styling
                    resetButton.classList.remove("btn-outline-secondary");

                    // Show the modal
                    const leagueOptionsModal = new bootstrap.Modal(document.getElementById("leagueOptionsModal"));
                    leagueOptionsModal.show();

                    // Redirect to a new page after success
                    // window.location.href = "/api/manageteam/"; 
                })
                .catch((error) => {
                    console.error(error);
                    showToast("Error saving team. Please try again.", "danger");
                });
        });

        const dismissButton = document.getElementById("dismissButton");

        dismissButton.addEventListener("click", function () {
            // Redirect to /api/manageteam/
            window.location.href = "/api/manageteam/";
        });


        // Helper function to get CSRF token
        function getCSRFToken() {
            const csrfTokenElement = document.querySelector('[name=csrfmiddlewaretoken]');
            return csrfTokenElement ? csrfTokenElement.value : "";
        }

        // Helper function to show toast messages
        function showToast(message, type) {
            const toastContainer = document.getElementById("toastContainer");
            if (!toastContainer) {
                console.error("Toast container not found.");
                return;
            }

            const toast = document.createElement("div");
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.role = "alert";
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            toastContainer.appendChild(toast);

            const bootstrapToast = new bootstrap.Toast(toast);
            bootstrapToast.show();

            toast.addEventListener("hidden.bs.toast", () => {
                toastContainer.removeChild(toast);
            });
        }

    });
</script>

<!-- Get the saved players -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const pitchFormation = document.getElementById("pitch-formation");
        const budgetDisplay = document.getElementById("budgetDisplay");
        const totalBudget = 100.0; // Initial budget

        // Function to update the budget display
        function updateBudgetDisplay(remainingBudget) {
            budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
        }

        // Function to render saved players on the pitch
        function renderSavedPlayers(savedTeam) {
            pitchFormation.innerHTML = ""; // Clear the pitch
            let totalPlayerPrice = 0;

            savedTeam.forEach((player) => {
                const positionDiv = document.createElement("div");
                positionDiv.className = "position-absolute text-center";
                positionDiv.style.transform = "translate(-50%, -50%)";

                // Parse the position coordinates from the data
                const coordinates = JSON.parse(player.position_coordinates || "{}");
                positionDiv.style.top = coordinates.top;
                positionDiv.style.left = coordinates.left;

                positionDiv.innerHTML = `
                    <div class="rounded text-center shadow-sm player-card" 
                        style="width: 50px; font-family: Arial, sans-serif; cursor: pointer;"  
                        data-name="${player.name}" 
                        data-position="${player.position}" 
                        data-price="${player.price}" 
                        data-image="${player.image || '{% static "images/m_salah.png" %}'}">

                        <div class="bg-success d-flex justify-content-center align-items-center" 
                            style="padding: 5px; border-top-left-radius: 10px; border-top-right-radius: 10px;">
                            <img src="${player.image || '{% static "images/m_salah.png" %}'}" alt="${player.name}" 
                                style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                        </div>

                        <div class="bg-light" 
                            style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; 
                            border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                            ${player.name.split(" ")[0]}
                        </div>
                    </div>
                `;

                // Attach click event listener to open modal
                positionDiv.querySelector(".player-card").addEventListener("click", function () {
                    const name = this.getAttribute("data-name");
                    const image = this.getAttribute("data-image");
                    const position = this.getAttribute("data-position");

                    showPlayerModal(name, image, position);
                });

                pitchFormation.appendChild(positionDiv);

                // Add the player's price to the total
                totalPlayerPrice += parseFloat(player.price) || 0;
            });
            // Calculate remaining budget and update the display
            const remainingBudget = totalBudget - totalPlayerPrice;
            updateBudgetDisplay(remainingBudget);
            console.log(totalPlayerPrice)
        }

        // Fetch saved players and render them on the pitch
        fetch("/api/get-saved-team/", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((response) => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error("Failed to fetch saved team.");
            })
            .then((data) => {
                if (data.team && data.team.length > 0) {
                    renderSavedPlayers(data.team); // Render players
                }
            })
            .catch((error) => {
                console.error("Error loading saved team:", error);
            });

        // Function to show modal with player details
        function showPlayerModal(name, image, position) {
            const modal = document.getElementById("playerModal");
            document.getElementById("modalPlayerName").textContent = name;
            document.getElementById("modalPlayerImage").src = image || "default-image.png"; // Fallback if no image
            document.getElementById("modalPlayerPosition").textContent = position || "Unknown";
            modal.style.display = "block";
        }

        // Close the modal
        document.getElementById("closeModalButton").addEventListener("click", function () {
            document.getElementById("playerModal").style.display = "none";
        });

        document.getElementById("playerModal").addEventListener("click", function (e) {
            if (e.target === this) {
                this.style.display = "none";
            }
        });
    });
</script>


{% endblock %}















































{% extends 'contests/base.html' %}

{% load static %}

{% block title %}Team Selection{% endblock %}

{% block content %}
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1050;" id="toastContainer">
</div>

<!-- Modal -->
<div id="leagueOptionsModal" class="modal fade" tabindex="-1" aria-labelledby="leagueOptionsModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"> <!-- Centered modal -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="leagueOptionsModalLabel">What would you like to do next?</h5>
                <button type="button" class="btn-close" id="dismissButton" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>You can either create a new league and invite your friends or join an existing league to compete.</p>
            </div>
            <div class="modal-footer">
                <a href="/api/create-league/" class="btn btn-primary"
                    style="background: linear-gradient(to right, #00ffc6, #007bff); color: white;">Create League</a>
                <a href="/api/league/" class="btn btn-secondary">Join League</a>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    <!-- Card Container -->
    <div class="p-4 rounded shadow-sm" style="background: linear-gradient(to right, #00ffc6, #007bff); color: white;">
        <!-- Card Content -->
        <div class="row row-cols-1 row-cols-md-2 g-4"> <!-- Bootstrap responsive classes for gaps -->
            <!-- Left Section -->
            <div class="col">
                <div class="rounded p-4 d-flex flex-column h-100"
                    style="background: linear-gradient(to left, #00ffc6, #007bff); min-height: 200px;">

                    <!-- Image and Text -->
                    <div class="d-flex align-items-center flex-nowrap">
                        <img src="{% static 'images/gaolpost-1.png' %}" alt="Goal Post" class="me-3"
                            style="width: 60px; height: 60px; border-radius: 50%;">
                        <div>
                            <h3 class="fw-bold mb-1 text-dark">{{ user_team.name }}</h3>
                            <h3 class="fw-bold mb-1 text-dark" id="teamName" style="display: none;">{{ user_team.name
                                }}#{{ user_team.id }}</h3>
                            <p class="fw-bold mb-2 text-dark" style="font-size: 0.8rem;">{{ user_team.user.username }}
                            </p>
                        </div>
                    </div>

                    <!-- Total Points and Global Ranking -->
                    <div class="bg-dark text-white rounded p-3 mt-auto"> <!-- Added mt-auto to push content down -->
                        <div class="row d-flex align-items-center">
                            <!-- Total Points Section -->
                            <div class="col-4 text-center d-flex flex-column align-items-center justify-content-center">
                                <h1 class="fw-bold mb-0">0</h1> <!-- Added mb-0 for tighter spacing -->
                                <p class="text-muted">Total Points</p>
                            </div>
                            <!-- Global Rank and Highest Points Section -->
                            <div class="col-8">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Global rank</span>
                                    <span>-</span>
                                </div>
                                <hr class="fade-hr my-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Highest points</span>
                                    <span>-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Right Section -->
            <div class="col">
                <div class="rounded p-4 d-flex flex-column h-100"
                    style="background: linear-gradient(to left, #00ffc6, #007bff); min-height: 200px;">
                    <h4 class="fw-bold  text-dark" style="font-size: 1.0rem;">Gameweek 21 Challenge</h4>
                    <h5 class="fw-bold  text-dark">Legends</h5>
                    <p class="text-dark">âš¡ Players who have been at their club for 5+ seasons earn double points</p>
                    <div class="d-flex justify-content-between mt-auto"> <!-- Added mt-auto to align inner boxes -->
                        <div class="p-3 rounded shadow-sm d-flex justify-content-between align-items-center"
                            style="background-color: #e8fff4; width: 100%; opacity: 0.8;">
                            <span class="text-dark" style="font-size: 0.8rem;">Players selected</span>
                            <div>
                                <span class="fw-bold text-dark">
                                    <span id="budgetDisplay">100.0m</span>
                                    <span class="text-dark" style="font-size: 0.8rem;">Remaining budget</span>
                                </span>
                            </div>

                            <span class="fw-bold text-dark">Unlimited</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div id="playerModal" class="modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
            <div class="modal-content"
                style="background: linear-gradient(to right, #00ffc6, #007bff); width: 90%; max-width: 600px; margin: 10% auto; padding: 20px; border-radius: 15px; color: white; text-align: center; position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">

                <!-- Close Button -->
                <button id="closeModalButton"
                    style="position: absolute; top: 10px; right: 20px; background: transparent; color: white; border: none; font-size: 1.5rem; cursor: pointer;">
                    X
                </button>

                <!-- Player Information -->
                <div class="d-flex align-items-center" style="flex-direction: column;">
                    <!-- Player Image -->
                    <img id="modalPlayerImage" src="" alt=""
                        style="width: 120px; height: 120px; border-radius: 50%; margin-bottom: 20px;">
                    <!-- Player Name and Position -->
                    <h3 id="modalPlayerName" style="margin: 0; font-size: 1.5rem;"></h3>
                    <p id="modalPlayerPosition" style="margin: 0; font-size: 1rem;">Midfielder</p>
                    <!-- Player Team -->
                    <p id="modalPlayerTeam" style="font-size: 1rem; color: #f9e000;">Brentford</p>
                </div>

                <!-- Stats Section -->
                <div class="d-flex justify-content-between align-items-center"
                    style="margin: 20px 0; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">Price</p>
                        <h4 id="modalPlayerPrice" style="margin: 5px 0;">7.8m</h4>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">Form</p>
                        <h4 id="modalPlayerForm" style="margin: 5px 0;">8.0</h4>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">TSB%</p>
                        <h4 id="modalPlayerTSB" style="margin: 5px 0;">5.43%</h4>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex justify-content-around">
                    <button class="btn btn-light"
                        style="padding: 10px 20px; border-radius: 20px; font-weight: bold; background: #1dcdfd; color: white; border: none;">
                        Make Captain
                    </button>
                    <button class="btn btn-light"
                        style="padding: 10px 20px; border-radius: 20px; font-weight: bold; background: #8e44ad; color: white; border: none;">
                        Transfer Out
                    </button>
                </div>
            </div>
        </div>


        <!-- Pitch Area bg-success -->
        <div class="col-md-8">
            <div class="position-relative rounded">
                <img src="{% static 'images/pitch.png' %}" alt="Pitch" class="img-fluid w-100 rounded">
                <div id="pitch-formation">
                    <!-- Formation players will be dynamically injected here -->
                </div>
            </div>
            <!-- Button Section -->
            <div class="container mt-3">
                <div class="row g-3 justify-content-center align-items-center">
                    <!-- Formation Dropdown -->
                    <div class="col-12 col-md-auto d-flex align-items-center bg-light border rounded p-3">
                        <label for="formation-select" style="font-size: 16px; margin-right: 8px;">Choose
                            formation</label>
                        <select id="formation-select" class="form-select form-select-lg" style="width: 150px;">
                            <option value="1-1-2">1-1-2</option>
                            <option value="4-4-2">4-4-2</option>
                            <option value="4-3-3">4-3-3</option>
                            <option value="3-5-2">3-5-2</option>
                            <option value="5-3-2">5-3-2</option>
                        </select>
                    </div>

                    <!-- Buttons -->
                    <div class="col-12 col-md-auto">
                        <button id="resetButton" class="btn btn-outline-secondary btn-lg w-100 mb-2 mb-md-0"
                            style="padding: 10px 20px;">Reset</button>
                    </div>
                    <div class="col-12 col-md-auto">
                        <button class="btn btn-outline-secondary btn-lg w-100 mb-2 mb-md-0" id="autoPickButton"
                            style="padding: 10px 20px;">
                            Auto pick
                        </button>
                    </div>
                    <div class="col-12 col-md-auto">
                        <button id="saveTeamButton" class="btn btn-primary btn-lg w-100"
                            style="background: linear-gradient(to right, #00ffc6, #007bff); color: rgb(255, 255, 255); padding: 10px 30px;">Save
                            team</button>
                    </div>

                </div>
            </div>
            <!-- Add the fixtures section below -->
            <div class="mt-4 bg-light rounded p-3">
                <h4 class="text-center fw-bold text-uppercase mb-3">Gameweek 21 Fixtures</h4>
                <p class="text-center text-muted">Final Deadline <strong>Thu 16 Jan 23:00</strong></p>
                <div class="text-center mb-3">
                    <button class="btn btn-primary">Deadlines explained</button>
                </div>
                <h5 class="fw-bold text-dark">Tuesday 14 January 2025</h5>
                <div class="timeline mt-3">
                    <!-- Match 1 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/brentford.png' %}" alt="Brentford" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Brentford</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Man City</span>
                                <img src="{% static 'images/man_city.png' %}" alt="Man City" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 2 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/chelsea.png' %}" alt="Chelsea" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Chelsea</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Bournemouth</span>
                                <img src="{% static 'images/bournemouth.png' %}" alt="Bournemouth" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 3 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/west_ham.png' %}" alt="West Ham" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>West Ham</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Fulham</span>
                                <img src="{% static 'images/fulham.png' %}" alt="Fulham" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 4 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/nottm_forest.png' %}" alt="Nott'm Forest" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Nott'm Forest</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Liverpool</span>
                                <img src="{% static 'images/liverpool.png' %}" alt="Liverpool" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 5 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/everton.png' %}" alt="Everton" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Everton</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Aston Villa</span>
                                <img src="{% static 'images/aston_villa.png' %}" alt="Aston Villa" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 6 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/leicester.png' %}" alt="Leicester" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Leicester</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Crystal Palace</span>
                                <img src="{% static 'images/crystal_palace.png' %}" alt="Crystal Palace"
                                    class="img-fluid" style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>
                </div>
            </div>

            <!-- Fixtures Section -->
            <div class="mt-4 bg-light rounded p-3">
                <h4 class="text-center fw-bold text-uppercase mb-3">Gameweek Fixtures</h4>
                <p class="text-center text-muted">Real-Time Matches</p>
                <div class="timeline mt-3">
                    {% for match in matches %}
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">{{ match.formatted_time }}</span>
                            <p class="text-muted small">{{ match.formatted_date }}</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{{ match.homeTeam.logo }}" alt="{{ match.homeTeam.name }}" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>{{ match.homeTeam.name }}</span>
                            </div>
                            <span class="fw-bold mx-3">vs</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>{{ match.awayTeam.name }}</span>
                                <img src="{{ match.awayTeam.logo }}" alt="{{ match.awayTeam.name }}" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>
                    {% endfor %}
                </div>
            </div>

            <select class="form-select mb-3" id="teamSelect">
                <option value="">Select a team...</option>
            </select>

            <table class="table table-striped table-bordered align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Player</th>
                        <th>Position</th>
                        <th>Nationality</th>
                        <th>Age</th>
                    </tr>
                </thead>
                <tbody id="playerTableBody">
                    <tr>
                        <td colspan="4" class="text-center">Select a team to view players.</td>
                    </tr>
                </tbody>
            </table>
            
        </div>

        <!-- Player Selection -->
        <div class="col-md-4">
            <div class="bg-white p-4 rounded shadow-sm">
                <h5 class="fw-bold">Player Selection</h5>
                <input type="text" class="form-control mb-3" placeholder="Search for player...">
                <select class="form-select mb-3">
                    <option>View</option>
                    <option>Defenders</option>
                    <option>Midfielders</option>
                </select>
                <select class="form-select mb-3">
                    <option>Sorted by</option>
                    <option>Total points</option>
                    <option>Price</option>
                </select>
                <p class="fw-bold mb-1">Max cost: Between 3.9 and 7.2</p>
                <div class="d-flex justify-content-between">
                    <span>7.2</span>
                    <input type="range" class="form-range">
                </div>
                <div class="form-check mt-3">
                    <input class="form-check-input" type="checkbox" id="fiveSeasons">
                    <label class="form-check-label" for="fiveSeasons">
                        Show Players who have been at their club for 5+ seasons
                    </label>
                </div>
                <button class="btn btn-primary w-100 mt-3">207 players shown</button>

                <!-- Goalkeepers Section -->
                <h5 class="fw-bold text-dark mt-4">Goalkeepers</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="Aaron Ramsdale"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Goalkeeper">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Aaron Ramsdale</span><br>
                                        <small class="text-muted">ARS GKP</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">123</td>
                            <td class="fw-bold text-center">20.5m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="David Raya"
                            data-image="{% static 'images/palmer.png' %}" data-position="Goalkeeper">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">David Raya</span><br>
                                        <small class="text-muted">ARS GKP</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-warning">MCI (A)</span></td>
                            <td class="text-center">97</td>
                            <td class="fw-bold text-center">40.0m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Defenders Section -->
                <h5 class="fw-bold text-dark mt-4">Defenders</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="William Saliba"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Defender">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">William Saliba</span><br>
                                        <small class="text-muted">ARS DEF</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-danger">LIV (A)</span></td>
                            <td class="text-center">110</td>
                            <td class="fw-bold text-center">50.2m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="Oleksandr Zinchenko"
                            data-image="{% static 'images/palmer.png' %}" data-position="Defender">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Oleksandr Zinchenko</span><br>
                                        <small class="text-muted">ARS DEF</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">102</td>
                            <td class="fw-bold text-center">52.0m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Midfielders Section -->
                <h5 class="fw-bold text-dark mt-4">Midfielders</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="Martin Degaard"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Midfielder">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Martin Degaard</span><br>
                                        <small class="text-muted">ARS MID</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-warning">MUN (H)</span></td>
                            <td class="text-center">140</td>
                            <td class="fw-bold text-center">6.8m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="Bukayo Saka"
                            data-image="{% static 'images/palmer.png' %}" data-position="Midfielder">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Bukayo Saka</span><br>
                                        <small class="text-muted">ARS MID</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">152</td>
                            <td class="fw-bold text-center">8.3m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Forwards Section -->
                <h5 class="fw-bold text-dark mt-4">Forwards</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="Gabriel Jesus"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Forward">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Gabriel Jesus</span><br>
                                        <small class="text-muted">ARS FWD</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-warning">MUN (H)</span></td>
                            <td class="text-center">87</td>
                            <td class="fw-bold text-center">8.0m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="Eddie Nketiah"
                            data-image="{% static 'images/palmer.png' %}" data-position="Forward">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Eddie Nketiah</span><br>
                                        <small class="text-muted">ARS FWD</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">65</td>
                            <td class="fw-bold text-center">6.4m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Pagination Controls -->
                <div class="d-flex justify-content-between align-items-center mt-4">
                    <span>1 of 20</span>
                    <div>
                        <button class="btn btn-light me-2"><i class="fas fa-chevron-left"></i></button>
                        <button class="btn btn-light"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

<!-- Auto Pitch -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Define formations and their respective positions
        const formations = {
            "1-1-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "45%", left: "50%" },
                { position: "Midfielder", top: "77%", left: "32%" },
                { position: "Midfielder", top: "77%", left: "67%" },
            ],
            "4-4-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "25%", left: "20%" },
                { position: "Defender", top: "25%", left: "40%" },
                { position: "Defender", top: "25%", left: "60%" },
                { position: "Defender", top: "25%", left: "80%" },
                { position: "Midfielder", top: "50%", left: "20%" },
                { position: "Midfielder", top: "50%", left: "40%" },
                { position: "Midfielder", top: "50%", left: "60%" },
                { position: "Midfielder", top: "50%", left: "80%" },
                { position: "Forward", top: "77%", left: "32%" },
                { position: "Forward", top: "77%", left: "67%" },
            ],
        };

        // Define available players with prices
        const players = [
            { name: "Aaron Ramsdale", position: "Goalkeeper", price: 4.5, image: "{% static 'images/m_salah.png' %}" },
            { name: "David Raya", position: "Goalkeeper", price: 4.8, image: "{% static 'images/m_salah.png' %}" },
            { name: "Ben White", position: "Defender", price: 5.0, image: "{% static 'images/m_salah.png' %}" },
            { name: "William Saliba", position: "Defender", price: 5.5, image: "{% static 'images/m_salah.png' %}" },
            { name: "Oleksandr Zinchenko", position: "Defender", price: 5.2, image: "{% static 'images/m_salah.png' %}" },
            { name: "Gabriel Magalhaes", position: "Defender", price: 5.0, image: "{% static 'images/m_salah.png' %}" },
            { name: "Martin Degaard", position: "Midfielder", price: 6.8, image: "{% static 'images/m_salah.png' %}" },
            { name: "Declan Rice", position: "Midfielder", price: 5.9, image: "{% static 'images/m_salah.png' %}" },
            { name: "Bukayo Saka", position: "Forward", price: 8.3, image: "{% static 'images/m_salah.png' %}" },
            { name: "Gabriel Jesus", position: "Forward", price: 8.0, image: "{% static 'images/m_salah.png' %}" },
        ];

        const formationSelect = document.getElementById("formation-select");
        const pitchFormation = document.getElementById("pitch-formation");
        const autoPickButton = document.getElementById("autoPickButton");
        const budgetDisplay = document.getElementById("budgetDisplay");

        let totalBudget = 100.0; // Total available budget
        let remainingBudget = totalBudget; // Remaining budget

        // Update the budget display
        function updateBudgetDisplay() {
            budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
        }

        // Function to render a formation
        function renderFormation(formationKey) {
            pitchFormation.innerHTML = ""; // Clear the pitch
            const formation = formations[formationKey];

            if (formation) {
                formation.forEach((position) => {
                    const positionDiv = document.createElement("div");
                    positionDiv.className = "position-absolute text-center";
                    positionDiv.style.top = position.top;
                    positionDiv.style.left = position.left;
                    positionDiv.style.transform = "translate(-50%, -50%)";
                    positionDiv.innerHTML = `
                    <div class="bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center" 
                        style="width: 50px; height: 50px;">
                        ${position.position}
                    </div>
                `;
                    pitchFormation.appendChild(positionDiv);
                });
            }
        }

        // Auto-pick players while considering the budget
        function autoPickPlayers(formationKey) {
            const formation = formations[formationKey];
            if (!formation) {
                console.error("Formation not found:", formationKey);
                return;
            }

            const shuffledPlayers = [...players].sort(() => 0.5 - Math.random());
            remainingBudget = totalBudget; // Reset budget
            updateBudgetDisplay(); // Update budget display
            pitchFormation.innerHTML = ""; // Clear the pitch

            formation.forEach((position) => {
                const player = shuffledPlayers.find((p) => p.position === position.position && p.price <= remainingBudget);
                if (player) {
                    const playerDiv = document.createElement("div");
                    playerDiv.className = "position-absolute text-center";
                    playerDiv.style.top = position.top;
                    playerDiv.style.left = position.left;
                    playerDiv.style.transform = "translate(-50%, -50%)";

                    playerDiv.innerHTML = `
                        <div class="rounded text-center shadow-sm player-card" 
                            style="width: 50px;  font-family: Arial, sans-serif; cursor: pointer;"  
                            data-name="${player.name}" 
                            data-image="${player.image}" 
                            data-position="${player.position}" 
                            data-price="${player.price}">

                            <div class="bg-success d-flex justify-content-center align-items-center" style="padding-top: 5px;border-top-left-radius: 10px; border-top-right-radius: 10px; padding: 5px;">
                                <img src="${player.image}" alt="${player.name.split(" ")[0]}" 
                                    style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                            </div>

                            <div class="bg-light" 
                                style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                                ${player.name.split(" ")[0]}
                            </div>

                        </div>
                    `;

                    // Add click event to open the modal
                    playerDiv.querySelector(".player-card").addEventListener("click", function () {
                        showPlayerModal(
                            this.getAttribute("data-name"),
                            this.getAttribute("data-image"),
                            this.getAttribute("data-position")
                        );
                    });

                    pitchFormation.appendChild(playerDiv);

                    // Deduct the player's price from the budget
                    remainingBudget -= player.price;
                    updateBudgetDisplay();
                }
            });
        }

        function showPlayerModal(name, image, position) {
            const modal = document.getElementById("playerModal");
            document.getElementById("modalPlayerName").textContent = name;
            document.getElementById("modalPlayerImage").src = image;
            document.getElementById("modalPlayerPosition").textContent = position;
            modal.style.display = "block";
        }

        document.getElementById("closeModalButton").addEventListener("click", function () {
            document.getElementById("playerModal").style.display = "none";
        });

        document.getElementById("playerModal").addEventListener("click", function (e) {
            if (e.target === this) {
                this.style.display = "none";
            }
        });

        // Event listener for formation dropdown change
        formationSelect.addEventListener("change", function () {
            renderFormation(this.value);
        });

        // Event listener for Auto-Pick button
        autoPickButton.addEventListener("click", function () {
            autoPickPlayers(formationSelect.value); // Trigger auto-pick based on the current formation
        });

        // Render default formation on load
        renderFormation("1-1-2");
        updateBudgetDisplay(); // Initialize budget display
    });

</script>

<!-- Manual $ Reset -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const formations = {
            "1-1-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "45%", left: "50%" },
                { position: "Midfielder", top: "77%", left: "32%" },
                { position: "Midfielder", top: "77%", left: "67%" },
            ],
            "4-4-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "25%", left: "20%" },
                { position: "Defender", top: "25%", left: "40%" },
                { position: "Defender", top: "25%", left: "60%" },
                { position: "Defender", top: "25%", left: "80%" },
                { position: "Midfielder", top: "50%", left: "20%" },
                { position: "Midfielder", top: "50%", left: "40%" },
                { position: "Midfielder", top: "50%", left: "60%" },
                { position: "Midfielder", top: "50%", left: "80%" },
                { position: "Forward", top: "77%", left: "32%" },
                { position: "Forward", top: "77%", left: "67%" },
            ],
        };

        const pitchFormation = document.getElementById("pitch-formation");
        const formationSelect = document.getElementById("formation-select");
        const resetButton = document.getElementById("resetButton");
        const playerSelectionRows = document.querySelectorAll(".player-selection-row");

        const maxBudget = 100; // Example budget in millions
        let remainingBudget = maxBudget; // Track the remaining budget
        let currentTotalPrice = 0; // Track the total price of added players

        let selectedPositionElement = null; // Track the currently selected position

        // Function to render a formation
        function renderFormation(formationKey) {
            pitchFormation.innerHTML = ""; // Clear the pitch
            const formation = formations[formationKey];

            if (formation) {
                formation.forEach((position, index) => {
                    const positionDiv = document.createElement("div");
                    positionDiv.className = "pitch-position position-absolute text-center";
                    positionDiv.style.top = position.top;
                    positionDiv.style.left = position.left;
                    positionDiv.style.transform = "translate(-50%, -50%)";
                    positionDiv.setAttribute("data-index", index);

                    positionDiv.innerHTML = `
                    <div class="bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center" 
                        style="width: 50px; height: 50px; cursor: pointer;">
                        ${position.position}
                    </div>
                `;

                    // Event listener for manual assignment
                    positionDiv.addEventListener("click", function () {
                        selectedPositionElement = positionDiv; // Store the clicked position
                        highlightPosition(selectedPositionElement);
                    });

                    pitchFormation.appendChild(positionDiv);
                });
            }
        }

        // Highlight the selected position
        function highlightPosition(positionDiv) {
            document.querySelectorAll(".pitch-position").forEach((div) => {
                div.style.border = ""; // Reset border for all positions
            });
            if (positionDiv) {
                positionDiv.style.border = "2px dashed green"; // Highlight the selected position Remaining Budget: Ksh
            }
        }

        // Update the displayed budget
        function updateBudgetDisplay() {
            const budgetDisplay = document.getElementById("budgetDisplay");
            budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
        }

        // Assign a player to the selected position
        function assignPlayerToPosition(player, price) {
            if (!selectedPositionElement) {
                showToast("Please select a position on the pitch first!", "danger");
                return;
            }

            if (price > remainingBudget) {
                showToast("Insufficient budget to add this player!", "danger");
                return;
            }

            if (currentTotalPrice + price > maxBudget) {
                showToast("Adding this player exceeds the total budget!", "danger");
                return;
            }

            // Deduct the player's price from the remaining budget and add to the total price
            remainingBudget -= price;
            currentTotalPrice += price;
            updateBudgetDisplay();

            selectedPositionElement.innerHTML = `
            <div class="rounded text-center shadow-sm player-card" 
                style="width: 50px; font-family: Arial, sans-serif; cursor: pointer;"
                data-name="${player.name}"
                data-image="${player.image}"
                data-position="${player.position}"
                data-price="${price}">

                <div class="bg-success d-flex justify-content-center align-items-center" 
                    style="padding: 5px; border-top-left-radius: 10px; border-top-right-radius: 10px;">
                    <img src="${player.image}" alt="${player.name}" 
                        style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                </div>
                <div class="bg-light" 
                    style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; 
                    border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                    ${player.name.split(" ")[0]}
                </div>
            </div>
        `;

            // Add click event to the new player card for modal functionality
            selectedPositionElement.querySelector(".player-card").addEventListener("click", function (e) {
                e.stopPropagation(); // Prevent event bubbling
                showPlayerModal(player.name, player.image, player.position);
            });

            highlightPosition(null); // Reset the highlight
            selectedPositionElement = null; // Clear selected position
        }

        // Show modal with player details
        function showPlayerModal(name, image, position) {
            const modal = document.getElementById("playerModal");
            document.getElementById("modalPlayerName").textContent = name;
            document.getElementById("modalPlayerImage").src = image;
            document.getElementById("modalPlayerPosition").textContent = position;
            modal.style.display = "block";
        }

        // Close the modal
        document.getElementById("closeModalButton").addEventListener("click", function () {
            document.getElementById("playerModal").style.display = "none";
        });

        document.getElementById("playerModal").addEventListener("click", function (e) {
            if (e.target === this) {
                this.style.display = "none";
            }
        });

        // Attach event listeners to player selection rows
        playerSelectionRows.forEach((row) => {
            row.addEventListener("click", function () {
                const player = {
                    name: this.getAttribute("data-name"),
                    image: this.getAttribute("data-image"),
                    position: this.getAttribute("data-position"),
                };

                const priceText = this.querySelector("td:nth-child(4)").textContent.trim(); // Extract price from 4th column
                const price = parseFloat(priceText.replace("m", ""));

                assignPlayerToPosition(player, price);
            });
        });

        // Reset button event listener
        resetButton.addEventListener("click", function () {
            renderFormation(formationSelect.value); // Re-render formation without players
            remainingBudget = maxBudget; // Reset budget
            currentTotalPrice = 0; // Reset total price
            updateBudgetDisplay();
        });

        // Event listener for formation dropdown change
        formationSelect.addEventListener("change", function () {
            renderFormation(this.value);
        });

        // Render default formation on load
        renderFormation("1-1-2");

        // Initialize budget display
        updateBudgetDisplay();
    });

</script>

<!-- Showing Toast -->
<script>
    function showToast(message, type = "danger") {
        const toastContainer = document.getElementById("toastContainer");

        // Create the toast element
        const toast = document.createElement("div");
        toast.className = `toast align-items-center text-white bg-${type} border-0`;
        toast.setAttribute("role", "alert");
        toast.setAttribute("aria-live", "assertive");
        toast.setAttribute("aria-atomic", "true");
        toast.setAttribute("data-bs-autohide", "true");
        toast.setAttribute("data-bs-delay", "3000");

        // Add the toast content
        toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    `;

        // Append the toast to the container
        toastContainer.appendChild(toast);

        // Initialize the toast using Bootstrap's JS
        const bootstrapToast = new bootstrap.Toast(toast);
        bootstrapToast.show();

        // Remove the toast from the DOM after it hides
        toast.addEventListener("hidden.bs.toast", () => {
            toast.remove();
        });
    }

</script>

<!-- Team Saving -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const saveTeamButton = document.getElementById("saveTeamButton");

        // Fetch team status on page load
        fetch("/api/check-team-status/", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((response) => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error("Failed to fetch team status.");
            })
            .then((data) => {
                if (data.team_exists) {
                    // Disable the save button if the team already exists
                    saveTeamButton.disabled = true;
                    saveTeamButton.textContent = "Team Saved";
                    saveTeamButton.classList.add("btn-secondary"); // Optional: Update button styling
                    saveTeamButton.classList.remove("btn-primary");

                    // Disable the Auto Pick and Reset buttons
                    autoPickButton.disabled = true;
                    autoPickButton.classList.add("btn-secondary"); // Optional: Update styling
                    autoPickButton.classList.remove("btn-outline-secondary");

                    resetButton.disabled = true;
                    resetButton.classList.add("btn-secondary"); // Optional: Update styling
                    resetButton.classList.remove("btn-outline-secondary");
                }
            })
            .catch((error) => {
                console.error("Error fetching team status:", error);
            });

        // Save Team Button Event Listener
        saveTeamButton.addEventListener("click", function () {
            const pitchPositions = document.querySelectorAll(".position-absolute .player-card");
            const teamData = [];
            const teamName = document.getElementById("teamName").textContent.trim();

            pitchPositions.forEach((playerCard) => {
                if (playerCard) {
                    const positionContainer = playerCard.parentElement; // Get parent container (position-absolute)
                    const positionCoordinates = {
                        top: positionContainer.style.top,
                        left: positionContainer.style.left,
                    };

                    const playerData = {
                        name: playerCard.getAttribute("data-name"),
                        position: playerCard.getAttribute("data-position"),
                        team: playerCard.getAttribute("data-team") || "Unknown",
                        formation_name: document.getElementById("formation-select").value,
                        score: parseInt(playerCard.getAttribute("data-score") || "0"),
                        position_coordinates: JSON.stringify(positionCoordinates), // Add coordinates as JSON string
                    };
                    teamData.push(playerData);
                }
            });


            if (teamData.length === 0) {
                showToast("No players selected to save.", "danger");
                return;
            }

            // Send the team data to the backend
            fetch("/api/save-team/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": getCSRFToken(),
                },
                body: JSON.stringify({ team_name: teamName, team: teamData }), // Ensure payload matches backend expectation
            })
                .then((response) => {
                    // console.log("Response status:", response.status); // Debug log
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error("Failed to save team.");
                })
                .then((data) => {
                    // Show success toast and disable button
                    showToast(data.message || "Team saved successfully!", "success");
                    saveTeamButton.disabled = true;
                    saveTeamButton.textContent = "Team Saved";
                    saveTeamButton.classList.add("btn-secondary");
                    saveTeamButton.classList.remove("btn-primary");

                    // Disable the Auto Pick and Reset buttons
                    autoPickButton.disabled = true;
                    autoPickButton.classList.add("btn-secondary"); // Optional: Update styling
                    autoPickButton.classList.remove("btn-outline-secondary");

                    resetButton.disabled = true;
                    resetButton.classList.add("btn-secondary"); // Optional: Update styling
                    resetButton.classList.remove("btn-outline-secondary");

                    // Show the modal
                    const leagueOptionsModal = new bootstrap.Modal(document.getElementById("leagueOptionsModal"));
                    leagueOptionsModal.show();

                    // Redirect to a new page after success
                    // window.location.href = "/api/manageteam/"; 
                })
                .catch((error) => {
                    console.error(error);
                    showToast("Error saving team. Please try again.", "danger");
                });
        });

        const dismissButton = document.getElementById("dismissButton");

        dismissButton.addEventListener("click", function () {
            // Redirect to /api/manageteam/
            window.location.href = "/api/manageteam/";
        });


        // Helper function to get CSRF token
        function getCSRFToken() {
            const csrfTokenElement = document.querySelector('[name=csrfmiddlewaretoken]');
            return csrfTokenElement ? csrfTokenElement.value : "";
        }

        // Helper function to show toast messages
        function showToast(message, type) {
            const toastContainer = document.getElementById("toastContainer");
            if (!toastContainer) {
                console.error("Toast container not found.");
                return;
            }

            const toast = document.createElement("div");
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.role = "alert";
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            toastContainer.appendChild(toast);

            const bootstrapToast = new bootstrap.Toast(toast);
            bootstrapToast.show();

            toast.addEventListener("hidden.bs.toast", () => {
                toastContainer.removeChild(toast);
            });
        }

    });
</script>

<!-- Get the saved players -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const pitchFormation = document.getElementById("pitch-formation");
        const budgetDisplay = document.getElementById("budgetDisplay");
        const totalBudget = 100.0; // Initial budget

        // Function to update the budget display
        function updateBudgetDisplay(remainingBudget) {
            budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
        }

        // Function to render saved players on the pitch
        function renderSavedPlayers(savedTeam) {
            pitchFormation.innerHTML = ""; // Clear the pitch
            let totalPlayerPrice = 0;

            savedTeam.forEach((player) => {
                const positionDiv = document.createElement("div");
                positionDiv.className = "position-absolute text-center";
                positionDiv.style.transform = "translate(-50%, -50%)";

                // Parse the position coordinates from the data
                const coordinates = JSON.parse(player.position_coordinates || "{}");
                positionDiv.style.top = coordinates.top;
                positionDiv.style.left = coordinates.left;

                positionDiv.innerHTML = `
                    <div class="rounded text-center shadow-sm player-card" 
                        style="width: 50px; font-family: Arial, sans-serif; cursor: pointer;"  
                        data-name="${player.name}" 
                        data-position="${player.position}" 
                        data-price="${player.price}" 
                        data-image="${player.image || '{% static "images/m_salah.png" %}'}">

                        <div class="bg-success d-flex justify-content-center align-items-center" 
                            style="padding: 5px; border-top-left-radius: 10px; border-top-right-radius: 10px;">
                            <img src="${player.image || '{% static "images/m_salah.png" %}'}" alt="${player.name}" 
                                style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                        </div>

                        <div class="bg-light" 
                            style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; 
                            border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                            ${player.name.split(" ")[0]}
                        </div>
                    </div>
                `;

                // Attach click event listener to open modal
                positionDiv.querySelector(".player-card").addEventListener("click", function () {
                    const name = this.getAttribute("data-name");
                    const image = this.getAttribute("data-image");
                    const position = this.getAttribute("data-position");

                    showPlayerModal(name, image, position);
                });

                pitchFormation.appendChild(positionDiv);

                // Add the player's price to the total
                totalPlayerPrice += parseFloat(player.price) || 0;
            });
            // Calculate remaining budget and update the display
            const remainingBudget = totalBudget - totalPlayerPrice;
            updateBudgetDisplay(remainingBudget);
            console.log(totalPlayerPrice)
        }

        // Fetch saved players and render them on the pitch
        fetch("/api/get-saved-team/", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((response) => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error("Failed to fetch saved team.");
            })
            .then((data) => {
                if (data.team && data.team.length > 0) {
                    renderSavedPlayers(data.team); // Render players
                }
            })
            .catch((error) => {
                console.error("Error loading saved team:", error);
            });

        // Function to show modal with player details
        function showPlayerModal(name, image, position) {
            const modal = document.getElementById("playerModal");
            document.getElementById("modalPlayerName").textContent = name;
            document.getElementById("modalPlayerImage").src = image || "default-image.png"; // Fallback if no image
            document.getElementById("modalPlayerPosition").textContent = position || "Unknown";
            modal.style.display = "block";
        }

        // Close the modal
        document.getElementById("closeModalButton").addEventListener("click", function () {
            document.getElementById("playerModal").style.display = "none";
        });

        document.getElementById("playerModal").addEventListener("click", function (e) {
            if (e.target === this) {
                this.style.display = "none";
            }
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
    const teamSelect = document.getElementById("teamSelect");
    const playerTableBody = document.getElementById("playerTableBody");

    // Fetch and populate teams
    fetch("/api/get-teams/")
        .then((response) => response.json())
        .then((data) => {
            if (data.teams) {
                data.teams.forEach((team) => {
                    const option = document.createElement("option");
                    option.value = team.id; // Use team ID as the value
                    option.textContent = team.name; // Display team name
                    teamSelect.appendChild(option);
                });
            }
        })
        .catch((error) => console.error("Error fetching teams:", error));

    // Fetch and display players when a team is selected
    teamSelect.addEventListener("change", function () {
        const teamId = teamSelect.value;

        // Clear the player table
        playerTableBody.innerHTML = `
            <tr>
                <td colspan="4" class="text-center">Loading players...</td>
            </tr>
        `;

        // Fetch players for the selected team
        fetch(`/api/get-players-by-team/?team_id=${teamId}`)
            .then((response) => response.json())
            .then((data) => {
                if (data.players) {
                    playerTableBody.innerHTML = ""; // Clear the loading row

                    data.players.forEach((player) => {
                        const row = `
                            <tr>
                                <td>${player.name}</td>
                                <td>${player.position}</td>
                                <td>${player.nationality}</td>
                                <td>${player.dateOfBirth ? calculateAge(player.dateOfBirth) : "N/A"}</td>
                            </tr>
                        `;
                        playerTableBody.innerHTML += row;
                    });
                } else {
                    playerTableBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="text-center">No players found for this team.</td>
                        </tr>
                    `;
                }
            })
            .catch((error) => {
                console.error("Error fetching players:", error);
                playerTableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center text-danger">Failed to load players.</td>
                    </tr>
                `;
            });
    });

    // Helper function to calculate age from date of birth
    function calculateAge(dob) {
        const birthDate = new Date(dob);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const m = today.getMonth() - birthDate.getMonth();
        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
            age--;
        }
        return age;
    }
});

</script>
{% endblock %}















































{% extends 'contests/base.html' %}

{% load static %}

{% block title %}Team Selection{% endblock %}

{% block content %}
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1050;" id="toastContainer">
</div>

<!-- Modal -->
<div id="leagueOptionsModal" class="modal fade" tabindex="-1" aria-labelledby="leagueOptionsModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"> <!-- Centered modal -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="leagueOptionsModalLabel">What would you like to do next?</h5>
                <button type="button" class="btn-close" id="dismissButton" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>You can either create a new league and invite your friends or join an existing league to compete.</p>
            </div>
            <div class="modal-footer">
                <a href="/api/create-league/" class="btn btn-primary"
                    style="background: linear-gradient(to right, #00ffc6, #007bff); color: white;">Create League</a>
                <a href="/api/league/" class="btn btn-secondary">Join League</a>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    <!-- Card Container -->
    <div class="p-4 rounded shadow-sm" style="background: linear-gradient(to right, #00ffc6, #007bff); color: white;">
        <!-- Card Content -->
        <div class="row row-cols-1 row-cols-md-2 g-4"> <!-- Bootstrap responsive classes for gaps -->
            <!-- Left Section -->
            <div class="col">
                <div class="rounded p-4 d-flex flex-column h-100"
                    style="background: linear-gradient(to left, #00ffc6, #007bff); min-height: 200px;">

                    <!-- Image and Text -->
                    <div class="d-flex align-items-center flex-nowrap">
                        <img src="{% static 'images/gaolpost-1.png' %}" alt="Goal Post" class="me-3"
                            style="width: 60px; height: 60px; border-radius: 50%;">
                        <div>
                            <h3 class="fw-bold mb-1 text-dark">{{ user_team.name }}</h3>
                            <h3 class="fw-bold mb-1 text-dark" id="teamName" style="display: none;">{{ user_team.name
                                }}#{{ user_team.id }}</h3>
                            <p class="fw-bold mb-2 text-dark" style="font-size: 0.8rem;">{{ user_team.user.username }}
                            </p>
                        </div>
                    </div>

                    <!-- Total Points and Global Ranking -->
                    <div class="bg-dark text-white rounded p-3 mt-auto"> <!-- Added mt-auto to push content down -->
                        <div class="row d-flex align-items-center">
                            <!-- Total Points Section -->
                            <div class="col-4 text-center d-flex flex-column align-items-center justify-content-center">
                                <h1 class="fw-bold mb-0">0</h1> <!-- Added mb-0 for tighter spacing -->
                                <p class="text-muted">Total Points</p>
                            </div>
                            <!-- Global Rank and Highest Points Section -->
                            <div class="col-8">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Global rank</span>
                                    <span>-</span>
                                </div>
                                <hr class="fade-hr my-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Highest points</span>
                                    <span>-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Right Section -->
            <div class="col">
                <div class="rounded p-4 d-flex flex-column h-100"
                    style="background: linear-gradient(to left, #00ffc6, #007bff); min-height: 200px;">
                    <h4 class="fw-bold  text-dark" style="font-size: 1.0rem;">Gameweek 21 Challenge</h4>
                    <h5 class="fw-bold  text-dark">Legends</h5>
                    <p class="text-dark">âš¡ Players who have been at their club for 5+ seasons earn double points</p>
                    <div class="d-flex justify-content-between mt-auto"> <!-- Added mt-auto to align inner boxes -->
                        <div class="p-3 rounded shadow-sm d-flex justify-content-between align-items-center"
                            style="background-color: #e8fff4; width: 100%; opacity: 0.8;">
                            <span class="text-dark" style="font-size: 0.8rem;">Players selected</span>
                            <div>
                                <span class="fw-bold text-dark">
                                    <span id="budgetDisplay">100.0m</span>
                                    <span class="text-dark" style="font-size: 0.8rem;">Remaining budget</span>
                                </span>
                            </div>

                            <span class="fw-bold text-dark">Unlimited</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div id="playerModal" class="modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
            <div class="modal-content"
                style="background: linear-gradient(to right, #00ffc6, #007bff); width: 90%; max-width: 600px; margin: 10% auto; padding: 20px; border-radius: 15px; color: white; text-align: center; position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">

                <!-- Close Button -->
                <button id="closeModalButton"
                    style="position: absolute; top: 10px; right: 20px; background: transparent; color: white; border: none; font-size: 1.5rem; cursor: pointer;">
                    X
                </button>

                <!-- Player Information -->
                <div class="d-flex align-items-center" style="flex-direction: column;">
                    <!-- Player Image -->
                    <img id="modalPlayerImage" src="" alt=""
                        style="width: 120px; height: 120px; border-radius: 50%; margin-bottom: 20px;">
                    <!-- Player Name and Position -->
                    <h3 id="modalPlayerName" style="margin: 0; font-size: 1.5rem;"></h3>
                    <p id="modalPlayerPosition" style="margin: 0; font-size: 1rem;">Midfielder</p>
                    <!-- Player Team -->
                    <p id="modalPlayerTeam" style="font-size: 1rem; color: #f9e000;">Brentford</p>
                </div>

                <!-- Stats Section -->
                <div class="d-flex justify-content-between align-items-center"
                    style="margin: 20px 0; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">Price</p>
                        <h4 id="modalPlayerPrice" style="margin: 5px 0;">7.8m</h4>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">Form</p>
                        <h4 id="modalPlayerForm" style="margin: 5px 0;">8.0</h4>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">TSB%</p>
                        <h4 id="modalPlayerTSB" style="margin: 5px 0;">5.43%</h4>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex justify-content-around">
                    <button class="btn btn-light"
                        style="padding: 10px 20px; border-radius: 20px; font-weight: bold; background: #1dcdfd; color: white; border: none;">
                        Make Captain
                    </button>
                    <button class="btn btn-light"
                        style="padding: 10px 20px; border-radius: 20px; font-weight: bold; background: #8e44ad; color: white; border: none;">
                        Transfer Out
                    </button>
                </div>
            </div>
        </div>


        <!-- Pitch Area bg-success -->
        <div class="col-md-8">
            <div class="position-relative rounded">
                <img src="{% static 'images/pitch.png' %}" alt="Pitch" class="img-fluid w-100 rounded">
                <div id="pitch-formation">
                    <!-- Formation players will be dynamically injected here -->
                </div>
            </div>
            <!-- Button Section -->
            <div class="container mt-3">
                <div class="row g-3 justify-content-center align-items-center">
                    <!-- Formation Dropdown -->
                    <div class="col-12 col-md-auto d-flex align-items-center bg-light border rounded p-3">
                        <label for="formation-select" style="font-size: 16px; margin-right: 8px;">Choose
                            formation</label>
                        <select id="formation-select" class="form-select form-select-lg" style="width: 150px;">
                            <option value="1-1-2">1-1-2</option>
                            <option value="4-4-2">4-4-2</option>
                            <option value="4-3-3">4-3-3</option>
                            <option value="3-5-2">3-5-2</option>
                            <option value="5-3-2">5-3-2</option>
                        </select>
                    </div>

                    <!-- Buttons -->
                    <div class="col-12 col-md-auto">
                        <button id="resetButton" class="btn btn-outline-secondary btn-lg w-100 mb-2 mb-md-0"
                            style="padding: 10px 20px;">Reset</button>
                    </div>
                    <div class="col-12 col-md-auto">
                        <button class="btn btn-outline-secondary btn-lg w-100 mb-2 mb-md-0" id="autoPickButton"
                            style="padding: 10px 20px;">
                            Auto pick
                        </button>
                    </div>
                    <div class="col-12 col-md-auto">
                        <button id="saveTeamButton" class="btn btn-primary btn-lg w-100"
                            style="background: linear-gradient(to right, #00ffc6, #007bff); color: rgb(255, 255, 255); padding: 10px 30px;">Save
                            team</button>
                    </div>

                </div>
            </div>
            <!-- Add the fixtures section below -->
            <div class="mt-4 bg-light rounded p-3">
                <h4 class="text-center fw-bold text-uppercase mb-3">Gameweek 21 Fixtures</h4>
                <p class="text-center text-muted">Final Deadline <strong>Thu 16 Jan 23:00</strong></p>
                <div class="text-center mb-3">
                    <button class="btn btn-primary">Deadlines explained</button>
                </div>
                <h5 class="fw-bold text-dark">Tuesday 14 January 2025</h5>
                <div class="timeline mt-3">
                    <!-- Match 1 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/brentford.png' %}" alt="Brentford" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Brentford</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Man City</span>
                                <img src="{% static 'images/man_city.png' %}" alt="Man City" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 2 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/chelsea.png' %}" alt="Chelsea" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Chelsea</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Bournemouth</span>
                                <img src="{% static 'images/bournemouth.png' %}" alt="Bournemouth" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 3 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/west_ham.png' %}" alt="West Ham" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>West Ham</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Fulham</span>
                                <img src="{% static 'images/fulham.png' %}" alt="Fulham" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 4 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/nottm_forest.png' %}" alt="Nott'm Forest" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Nott'm Forest</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Liverpool</span>
                                <img src="{% static 'images/liverpool.png' %}" alt="Liverpool" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 5 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/everton.png' %}" alt="Everton" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Everton</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Aston Villa</span>
                                <img src="{% static 'images/aston_villa.png' %}" alt="Aston Villa" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 6 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/leicester.png' %}" alt="Leicester" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Leicester</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Crystal Palace</span>
                                <img src="{% static 'images/crystal_palace.png' %}" alt="Crystal Palace"
                                    class="img-fluid" style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>
                </div>
            </div>

            <!-- Fixtures Section -->
            <div class="mt-4 bg-light rounded p-3">
                <h4 class="text-center fw-bold text-uppercase mb-3">Gameweek Fixtures</h4>
                <p class="text-center text-muted">Real-Time Matches</p>
                <div class="timeline mt-3">
                    {% for match in matches %}
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">{{ match.formatted_time }}</span>
                            <p class="text-muted small">{{ match.formatted_date }}</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{{ match.homeTeam.logo }}" alt="{{ match.homeTeam.name }}" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>{{ match.homeTeam.name }}</span>
                            </div>
                            <span class="fw-bold mx-3">vs</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>{{ match.awayTeam.name }}</span>
                                <img src="{{ match.awayTeam.logo }}" alt="{{ match.awayTeam.name }}" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>
                    {% endfor %}
                </div>
            </div>

            <select class="form-select mb-3" id="teamSelect">
                <option value="">Select a team...</option>
            </select>

            <table class="table table-striped table-bordered align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Player</th>
                        <th>Position</th>
                        <th>Nationality</th>
                        <th>Age</th>
                    </tr>
                </thead>
                <tbody id="playerTableBody">
                    <tr>
                        <td colspan="4" class="text-center">Select a team to view players.</td>
                    </tr>
                </tbody>
            </table>
            
        </div>

        <!-- Player Selection -->
        <div class="col-md-4">
            <div class="bg-white p-4 rounded shadow-sm">
                <h5 class="fw-bold">Player Selection</h5>
                <input type="text" class="form-control mb-3" placeholder="Search for player...">
                <select class="form-select mb-3">
                    <option>View</option>
                    <option>Defenders</option>
                    <option>Midfielders</option>
                </select>
                <select class="form-select mb-3">
                    <option>Sorted by</option>
                    <option>Total points</option>
                    <option>Price</option>
                </select>
                <p class="fw-bold mb-1">Max cost: Between 3.9 and 7.2</p>
                <div class="d-flex justify-content-between">
                    <span>7.2</span>
                    <input type="range" class="form-range">
                </div>
                <div class="form-check mt-3">
                    <input class="form-check-input" type="checkbox" id="fiveSeasons">
                    <label class="form-check-label" for="fiveSeasons">
                        Show Players who have been at their club for 5+ seasons
                    </label>
                </div>
                <button class="btn btn-primary w-100 mt-3">207 players shown</button>

                <!-- Goalkeepers Section -->
                <h5 class="fw-bold text-dark mt-4">Goalkeepers</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="Aaron Ramsdale"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Goalkeeper">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Aaron Ramsdale</span><br>
                                        <small class="text-muted">ARS GKP</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">123</td>
                            <td class="fw-bold text-center">20.5m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="David Raya"
                            data-image="{% static 'images/palmer.png' %}" data-position="Goalkeeper">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">David Raya</span><br>
                                        <small class="text-muted">ARS GKP</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-warning">MCI (A)</span></td>
                            <td class="text-center">97</td>
                            <td class="fw-bold text-center">40.0m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Defenders Section -->
                <h5 class="fw-bold text-dark mt-4">Defenders</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="William Saliba"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Defender">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">William Saliba</span><br>
                                        <small class="text-muted">ARS DEF</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-danger">LIV (A)</span></td>
                            <td class="text-center">110</td>
                            <td class="fw-bold text-center">50.2m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="Oleksandr Zinchenko"
                            data-image="{% static 'images/palmer.png' %}" data-position="Defender">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Oleksandr Zinchenko</span><br>
                                        <small class="text-muted">ARS DEF</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">102</td>
                            <td class="fw-bold text-center">52.0m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Midfielders Section -->
                <h5 class="fw-bold text-dark mt-4">Midfielders</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="Martin Degaard"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Midfielder">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Martin Degaard</span><br>
                                        <small class="text-muted">ARS MID</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-warning">MUN (H)</span></td>
                            <td class="text-center">140</td>
                            <td class="fw-bold text-center">6.8m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="Bukayo Saka"
                            data-image="{% static 'images/palmer.png' %}" data-position="Midfielder">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Bukayo Saka</span><br>
                                        <small class="text-muted">ARS MID</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">152</td>
                            <td class="fw-bold text-center">8.3m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Forwards Section -->
                <h5 class="fw-bold text-dark mt-4">Forwards</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="Gabriel Jesus"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Forward">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Gabriel Jesus</span><br>
                                        <small class="text-muted">ARS FWD</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-warning">MUN (H)</span></td>
                            <td class="text-center">87</td>
                            <td class="fw-bold text-center">8.0m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="Eddie Nketiah"
                            data-image="{% static 'images/palmer.png' %}" data-position="Forward">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Eddie Nketiah</span><br>
                                        <small class="text-muted">ARS FWD</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">65</td>
                            <td class="fw-bold text-center">6.4m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Pagination Controls -->
                <div class="d-flex justify-content-between align-items-center mt-4">
                    <span>1 of 20</span>
                    <div>
                        <button class="btn btn-light me-2"><i class="fas fa-chevron-left"></i></button>
                        <button class="btn btn-light"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

<!-- Auto Pitch -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Define formations and their respective positions
        const formations = {
            "1-1-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "45%", left: "50%" },
                { position: "Midfielder", top: "77%", left: "32%" },
                { position: "Midfielder", top: "77%", left: "67%" },
            ],
            "4-4-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "25%", left: "20%" },
                { position: "Defender", top: "25%", left: "40%" },
                { position: "Defender", top: "25%", left: "60%" },
                { position: "Defender", top: "25%", left: "80%" },
                { position: "Midfielder", top: "50%", left: "20%" },
                { position: "Midfielder", top: "50%", left: "40%" },
                { position: "Midfielder", top: "50%", left: "60%" },
                { position: "Midfielder", top: "50%", left: "80%" },
                { position: "Forward", top: "77%", left: "32%" },
                { position: "Forward", top: "77%", left: "67%" },
            ],
        };

        // Define available players with prices
        const players = [
            { name: "Aaron Ramsdale", position: "Goalkeeper", price: 4.5, image: "{% static 'images/m_salah.png' %}" },
            { name: "David Raya", position: "Goalkeeper", price: 4.8, image: "{% static 'images/m_salah.png' %}" },
            { name: "Ben White", position: "Defender", price: 5.0, image: "{% static 'images/m_salah.png' %}" },
            { name: "William Saliba", position: "Defender", price: 5.5, image: "{% static 'images/m_salah.png' %}" },
            { name: "Oleksandr Zinchenko", position: "Defender", price: 5.2, image: "{% static 'images/m_salah.png' %}" },
            { name: "Gabriel Magalhaes", position: "Defender", price: 5.0, image: "{% static 'images/m_salah.png' %}" },
            { name: "Martin Degaard", position: "Midfielder", price: 6.8, image: "{% static 'images/m_salah.png' %}" },
            { name: "Declan Rice", position: "Midfielder", price: 5.9, image: "{% static 'images/m_salah.png' %}" },
            { name: "Bukayo Saka", position: "Forward", price: 8.3, image: "{% static 'images/m_salah.png' %}" },
            { name: "Gabriel Jesus", position: "Forward", price: 8.0, image: "{% static 'images/m_salah.png' %}" },
        ];

        const formationSelect = document.getElementById("formation-select");
        const pitchFormation = document.getElementById("pitch-formation");
        const autoPickButton = document.getElementById("autoPickButton");
        const budgetDisplay = document.getElementById("budgetDisplay");

        let totalBudget = 100.0; // Total available budget
        let remainingBudget = totalBudget; // Remaining budget

        // Update the budget display
        function updateBudgetDisplay() {
            budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
        }

        // Function to render a formation
        function renderFormation(formationKey) {
            pitchFormation.innerHTML = ""; // Clear the pitch
            const formation = formations[formationKey];

            if (formation) {
                formation.forEach((position) => {
                    const positionDiv = document.createElement("div");
                    positionDiv.className = "position-absolute text-center";
                    positionDiv.style.top = position.top;
                    positionDiv.style.left = position.left;
                    positionDiv.style.transform = "translate(-50%, -50%)";
                    positionDiv.innerHTML = `
                    <div class="bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center" 
                        style="width: 50px; height: 50px;">
                        ${position.position}
                    </div>
                `;
                    pitchFormation.appendChild(positionDiv);
                });
            }
        }

        // Auto-pick players while considering the budget
        function autoPickPlayers(formationKey) {
            const formation = formations[formationKey];
            if (!formation) {
                console.error("Formation not found:", formationKey);
                return;
            }

            const shuffledPlayers = [...players].sort(() => 0.5 - Math.random());
            remainingBudget = totalBudget; // Reset budget
            updateBudgetDisplay(); // Update budget display
            pitchFormation.innerHTML = ""; // Clear the pitch

            formation.forEach((position) => {
                const player = shuffledPlayers.find((p) => p.position === position.position && p.price <= remainingBudget);
                if (player) {
                    const playerDiv = document.createElement("div");
                    playerDiv.className = "position-absolute text-center";
                    playerDiv.style.top = position.top;
                    playerDiv.style.left = position.left;
                    playerDiv.style.transform = "translate(-50%, -50%)";

                    playerDiv.innerHTML = `
                        <div class="rounded text-center shadow-sm player-card" 
                            style="width: 50px;  font-family: Arial, sans-serif; cursor: pointer;"  
                            data-name="${player.name}" 
                            data-image="${player.image}" 
                            data-position="${player.position}" 
                            data-price="${player.price}">

                            <div class="bg-success d-flex justify-content-center align-items-center" style="padding-top: 5px;border-top-left-radius: 10px; border-top-right-radius: 10px; padding: 5px;">
                                <img src="${player.image}" alt="${player.name.split(" ")[0]}" 
                                    style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                            </div>

                            <div class="bg-light" 
                                style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                                ${player.name.split(" ")[0]}
                            </div>

                        </div>
                    `;

                    // Add click event to open the modal
                    playerDiv.querySelector(".player-card").addEventListener("click", function () {
                        showPlayerModal(
                            this.getAttribute("data-name"),
                            this.getAttribute("data-image"),
                            this.getAttribute("data-position")
                        );
                    });

                    pitchFormation.appendChild(playerDiv);

                    // Deduct the player's price from the budget
                    remainingBudget -= player.price;
                    updateBudgetDisplay();
                }
            });
        }

        function showPlayerModal(name, image, position) {
            const modal = document.getElementById("playerModal");
            document.getElementById("modalPlayerName").textContent = name;
            document.getElementById("modalPlayerImage").src = image;
            document.getElementById("modalPlayerPosition").textContent = position;
            modal.style.display = "block";
        }

        document.getElementById("closeModalButton").addEventListener("click", function () {
            document.getElementById("playerModal").style.display = "none";
        });

        document.getElementById("playerModal").addEventListener("click", function (e) {
            if (e.target === this) {
                this.style.display = "none";
            }
        });

        // Event listener for formation dropdown change
        formationSelect.addEventListener("change", function () {
            renderFormation(this.value);
        });

        // Event listener for Auto-Pick button
        autoPickButton.addEventListener("click", function () {
            autoPickPlayers(formationSelect.value); // Trigger auto-pick based on the current formation
        });

        // Render default formation on load
        renderFormation("1-1-2");
        updateBudgetDisplay(); // Initialize budget display
    });

</script>

<!-- Manual $ Reset -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const formations = {
            "1-1-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "45%", left: "50%" },
                { position: "Midfielder", top: "77%", left: "32%" },
                { position: "Midfielder", top: "77%", left: "67%" },
            ],
            "4-4-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "25%", left: "20%" },
                { position: "Defender", top: "25%", left: "40%" },
                { position: "Defender", top: "25%", left: "60%" },
                { position: "Defender", top: "25%", left: "80%" },
                { position: "Midfielder", top: "50%", left: "20%" },
                { position: "Midfielder", top: "50%", left: "40%" },
                { position: "Midfielder", top: "50%", left: "60%" },
                { position: "Midfielder", top: "50%", left: "80%" },
                { position: "Forward", top: "77%", left: "32%" },
                { position: "Forward", top: "77%", left: "67%" },
            ],
        };

        const pitchFormation = document.getElementById("pitch-formation");
        const formationSelect = document.getElementById("formation-select");
        const resetButton = document.getElementById("resetButton");
        const playerSelectionRows = document.querySelectorAll(".player-selection-row");

        const maxBudget = 100; // Example budget in millions
        let remainingBudget = maxBudget; // Track the remaining budget
        let currentTotalPrice = 0; // Track the total price of added players

        let selectedPositionElement = null; // Track the currently selected position

        // Function to render a formation
        function renderFormation(formationKey) {
            pitchFormation.innerHTML = ""; // Clear the pitch
            const formation = formations[formationKey];

            if (formation) {
                formation.forEach((position, index) => {
                    const positionDiv = document.createElement("div");
                    positionDiv.className = "pitch-position position-absolute text-center";
                    positionDiv.style.top = position.top;
                    positionDiv.style.left = position.left;
                    positionDiv.style.transform = "translate(-50%, -50%)";
                    positionDiv.setAttribute("data-index", index);

                    positionDiv.innerHTML = `
                    <div class="bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center" 
                        style="width: 50px; height: 50px; cursor: pointer;">
                        ${position.position}
                    </div>
                `;

                    // Event listener for manual assignment
                    positionDiv.addEventListener("click", function () {
                        selectedPositionElement = positionDiv; // Store the clicked position
                        highlightPosition(selectedPositionElement);
                    });

                    pitchFormation.appendChild(positionDiv);
                });
            }
        }

        // Highlight the selected position
        function highlightPosition(positionDiv) {
            document.querySelectorAll(".pitch-position").forEach((div) => {
                div.style.border = ""; // Reset border for all positions
            });
            if (positionDiv) {
                positionDiv.style.border = "2px dashed green"; // Highlight the selected position Remaining Budget: Ksh
            }
        }

        // Update the displayed budget
        function updateBudgetDisplay() {
            const budgetDisplay = document.getElementById("budgetDisplay");
            budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
        }

        // Assign a player to the selected position
        function assignPlayerToPosition(player, price) {
            if (!selectedPositionElement) {
                showToast("Please select a position on the pitch first!", "danger");
                return;
            }

            if (price > remainingBudget) {
                showToast("Insufficient budget to add this player!", "danger");
                return;
            }

            if (currentTotalPrice + price > maxBudget) {
                showToast("Adding this player exceeds the total budget!", "danger");
                return;
            }

            // Deduct the player's price from the remaining budget and add to the total price
            remainingBudget -= price;
            currentTotalPrice += price;
            updateBudgetDisplay();

            selectedPositionElement.innerHTML = `
            <div class="rounded text-center shadow-sm player-card" 
                style="width: 50px; font-family: Arial, sans-serif; cursor: pointer;"
                data-name="${player.name}"
                data-image="${player.image}"
                data-position="${player.position}"
                data-price="${price}">

                <div class="bg-success d-flex justify-content-center align-items-center" 
                    style="padding: 5px; border-top-left-radius: 10px; border-top-right-radius: 10px;">
                    <img src="${player.image}" alt="${player.name}" 
                        style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                </div>
                <div class="bg-light" 
                    style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; 
                    border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                    ${player.name.split(" ")[0]}
                </div>
            </div>
        `;

            // Add click event to the new player card for modal functionality
            selectedPositionElement.querySelector(".player-card").addEventListener("click", function (e) {
                e.stopPropagation(); // Prevent event bubbling
                showPlayerModal(player.name, player.image, player.position);
            });

            highlightPosition(null); // Reset the highlight
            selectedPositionElement = null; // Clear selected position
        }

        // Show modal with player details
        function showPlayerModal(name, image, position) {
            const modal = document.getElementById("playerModal");
            document.getElementById("modalPlayerName").textContent = name;
            document.getElementById("modalPlayerImage").src = image;
            document.getElementById("modalPlayerPosition").textContent = position;
            modal.style.display = "block";
        }

        // Close the modal
        document.getElementById("closeModalButton").addEventListener("click", function () {
            document.getElementById("playerModal").style.display = "none";
        });

        document.getElementById("playerModal").addEventListener("click", function (e) {
            if (e.target === this) {
                this.style.display = "none";
            }
        });

        // Attach event listeners to player selection rows
        playerSelectionRows.forEach((row) => {
            row.addEventListener("click", function () {
                const player = {
                    name: this.getAttribute("data-name"),
                    image: this.getAttribute("data-image"),
                    position: this.getAttribute("data-position"),
                };

                const priceText = this.querySelector("td:nth-child(4)").textContent.trim(); // Extract price from 4th column
                const price = parseFloat(priceText.replace("m", ""));

                assignPlayerToPosition(player, price);
            });
        });

        // Reset button event listener
        resetButton.addEventListener("click", function () {
            renderFormation(formationSelect.value); // Re-render formation without players
            remainingBudget = maxBudget; // Reset budget
            currentTotalPrice = 0; // Reset total price
            updateBudgetDisplay();
        });

        // Event listener for formation dropdown change
        formationSelect.addEventListener("change", function () {
            renderFormation(this.value);
        });

        // Render default formation on load
        renderFormation("1-1-2");

        // Initialize budget display
        updateBudgetDisplay();
    });

</script>

<!-- Showing Toast -->
<script>
    function showToast(message, type = "danger") {
        const toastContainer = document.getElementById("toastContainer");

        // Create the toast element
        const toast = document.createElement("div");
        toast.className = `toast align-items-center text-white bg-${type} border-0`;
        toast.setAttribute("role", "alert");
        toast.setAttribute("aria-live", "assertive");
        toast.setAttribute("aria-atomic", "true");
        toast.setAttribute("data-bs-autohide", "true");
        toast.setAttribute("data-bs-delay", "3000");

        // Add the toast content
        toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    `;

        // Append the toast to the container
        toastContainer.appendChild(toast);

        // Initialize the toast using Bootstrap's JS
        const bootstrapToast = new bootstrap.Toast(toast);
        bootstrapToast.show();

        // Remove the toast from the DOM after it hides
        toast.addEventListener("hidden.bs.toast", () => {
            toast.remove();
        });
    }

</script>

<!-- Team Saving -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const saveTeamButton = document.getElementById("saveTeamButton");

        // Fetch team status on page load
        fetch("/api/check-team-status/", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((response) => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error("Failed to fetch team status.");
            })
            .then((data) => {
                if (data.team_exists) {
                    // Disable the save button if the team already exists
                    saveTeamButton.disabled = true;
                    saveTeamButton.textContent = "Team Saved";
                    saveTeamButton.classList.add("btn-secondary"); // Optional: Update button styling
                    saveTeamButton.classList.remove("btn-primary");

                    // Disable the Auto Pick and Reset buttons
                    autoPickButton.disabled = true;
                    autoPickButton.classList.add("btn-secondary"); // Optional: Update styling
                    autoPickButton.classList.remove("btn-outline-secondary");

                    resetButton.disabled = true;
                    resetButton.classList.add("btn-secondary"); // Optional: Update styling
                    resetButton.classList.remove("btn-outline-secondary");
                }
            })
            .catch((error) => {
                console.error("Error fetching team status:", error);
            });

        // Save Team Button Event Listener
        saveTeamButton.addEventListener("click", function () {
            const pitchPositions = document.querySelectorAll(".position-absolute .player-card");
            const teamData = [];
            const teamName = document.getElementById("teamName").textContent.trim();

            pitchPositions.forEach((playerCard) => {
                if (playerCard) {
                    const positionContainer = playerCard.parentElement; // Get parent container (position-absolute)
                    const positionCoordinates = {
                        top: positionContainer.style.top,
                        left: positionContainer.style.left,
                    };

                    const playerData = {
                        name: playerCard.getAttribute("data-name"),
                        position: playerCard.getAttribute("data-position"),
                        team: playerCard.getAttribute("data-team") || "Unknown",
                        formation_name: document.getElementById("formation-select").value,
                        score: parseInt(playerCard.getAttribute("data-score") || "0"),
                        position_coordinates: JSON.stringify(positionCoordinates), // Add coordinates as JSON string
                    };
                    teamData.push(playerData);
                }
            });


            if (teamData.length === 0) {
                showToast("No players selected to save.", "danger");
                return;
            }

            // Send the team data to the backend
            fetch("/api/save-team/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": getCSRFToken(),
                },
                body: JSON.stringify({ team_name: teamName, team: teamData }), // Ensure payload matches backend expectation
            })
                .then((response) => {
                    // console.log("Response status:", response.status); // Debug log
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error("Failed to save team.");
                })
                .then((data) => {
                    // Show success toast and disable button
                    showToast(data.message || "Team saved successfully!", "success");
                    saveTeamButton.disabled = true;
                    saveTeamButton.textContent = "Team Saved";
                    saveTeamButton.classList.add("btn-secondary");
                    saveTeamButton.classList.remove("btn-primary");

                    // Disable the Auto Pick and Reset buttons
                    autoPickButton.disabled = true;
                    autoPickButton.classList.add("btn-secondary"); // Optional: Update styling
                    autoPickButton.classList.remove("btn-outline-secondary");

                    resetButton.disabled = true;
                    resetButton.classList.add("btn-secondary"); // Optional: Update styling
                    resetButton.classList.remove("btn-outline-secondary");

                    // Show the modal
                    const leagueOptionsModal = new bootstrap.Modal(document.getElementById("leagueOptionsModal"));
                    leagueOptionsModal.show();

                    // Redirect to a new page after success
                    // window.location.href = "/api/manageteam/"; 
                })
                .catch((error) => {
                    console.error(error);
                    showToast("Error saving team. Please try again.", "danger");
                });
        });

        const dismissButton = document.getElementById("dismissButton");

        dismissButton.addEventListener("click", function () {
            // Redirect to /api/manageteam/
            window.location.href = "/api/manageteam/";
        });


        // Helper function to get CSRF token
        function getCSRFToken() {
            const csrfTokenElement = document.querySelector('[name=csrfmiddlewaretoken]');
            return csrfTokenElement ? csrfTokenElement.value : "";
        }

        // Helper function to show toast messages
        function showToast(message, type) {
            const toastContainer = document.getElementById("toastContainer");
            if (!toastContainer) {
                console.error("Toast container not found.");
                return;
            }

            const toast = document.createElement("div");
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.role = "alert";
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            toastContainer.appendChild(toast);

            const bootstrapToast = new bootstrap.Toast(toast);
            bootstrapToast.show();

            toast.addEventListener("hidden.bs.toast", () => {
                toastContainer.removeChild(toast);
            });
        }

    });
</script>

<!-- Get the saved players -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const pitchFormation = document.getElementById("pitch-formation");
        const budgetDisplay = document.getElementById("budgetDisplay");
        const totalBudget = 100.0; // Initial budget

        // Function to update the budget display
        function updateBudgetDisplay(remainingBudget) {
            budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
        }

        // Function to render saved players on the pitch
        function renderSavedPlayers(savedTeam) {
            pitchFormation.innerHTML = ""; // Clear the pitch
            let totalPlayerPrice = 0;

            savedTeam.forEach((player) => {
                const positionDiv = document.createElement("div");
                positionDiv.className = "position-absolute text-center";
                positionDiv.style.transform = "translate(-50%, -50%)";

                // Parse the position coordinates from the data
                const coordinates = JSON.parse(player.position_coordinates || "{}");
                positionDiv.style.top = coordinates.top;
                positionDiv.style.left = coordinates.left;

                positionDiv.innerHTML = `
                    <div class="rounded text-center shadow-sm player-card" 
                        style="width: 50px; font-family: Arial, sans-serif; cursor: pointer;"  
                        data-name="${player.name}" 
                        data-position="${player.position}" 
                        data-price="${player.price}" 
                        data-image="${player.image || '{% static "images/m_salah.png" %}'}">

                        <div class="bg-success d-flex justify-content-center align-items-center" 
                            style="padding: 5px; border-top-left-radius: 10px; border-top-right-radius: 10px;">
                            <img src="${player.image || '{% static "images/m_salah.png" %}'}" alt="${player.name}" 
                                style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                        </div>

                        <div class="bg-light" 
                            style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; 
                            border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                            ${player.name.split(" ")[0]}
                        </div>
                    </div>
                `;

                // Attach click event listener to open modal
                positionDiv.querySelector(".player-card").addEventListener("click", function () {
                    const name = this.getAttribute("data-name");
                    const image = this.getAttribute("data-image");
                    const position = this.getAttribute("data-position");

                    showPlayerModal(name, image, position);
                });

                pitchFormation.appendChild(positionDiv);

                // Add the player's price to the total
                totalPlayerPrice += parseFloat(player.price) || 0;
            });
            // Calculate remaining budget and update the display
            const remainingBudget = totalBudget - totalPlayerPrice;
            updateBudgetDisplay(remainingBudget);
            console.log(totalPlayerPrice)
        }

        // Fetch saved players and render them on the pitch
        fetch("/api/get-saved-team/", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((response) => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error("Failed to fetch saved team.");
            })
            .then((data) => {
                if (data.team && data.team.length > 0) {
                    renderSavedPlayers(data.team); // Render players
                }
            })
            .catch((error) => {
                console.error("Error loading saved team:", error);
            });

        // Function to show modal with player details
        function showPlayerModal(name, image, position) {
            const modal = document.getElementById("playerModal");
            document.getElementById("modalPlayerName").textContent = name;
            document.getElementById("modalPlayerImage").src = image || "default-image.png"; // Fallback if no image
            document.getElementById("modalPlayerPosition").textContent = position || "Unknown";
            modal.style.display = "block";
        }

        // Close the modal
        document.getElementById("closeModalButton").addEventListener("click", function () {
            document.getElementById("playerModal").style.display = "none";
        });

        document.getElementById("playerModal").addEventListener("click", function (e) {
            if (e.target === this) {
                this.style.display = "none";
            }
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
    const teamSelect = document.getElementById("teamSelect");
    const playerTableBody = document.getElementById("playerTableBody");

    // Fetch and populate teams
    fetch("/api/get-teams/")
        .then((response) => response.json())
        .then((data) => {
            if (data.teams) {
                data.teams.forEach((team) => {
                    const option = document.createElement("option");
                    option.value = team.id; // Use team ID as the value
                    option.textContent = team.name; // Display team name
                    teamSelect.appendChild(option);
                });
            }
        })
        .catch((error) => console.error("Error fetching teams:", error));

    // Fetch and display players when a team is selected
    teamSelect.addEventListener("change", function () {
        const teamId = teamSelect.value;

        // Clear the player table
        playerTableBody.innerHTML = `
            <tr>
                <td colspan="4" class="text-center">Loading players...</td>
            </tr>
        `;

        // Fetch players for the selected team
        fetch(`/api/get-players-by-team/?team_id=${teamId}`)
            .then((response) => response.json())
            .then((data) => {
                if (data.players) {
                    playerTableBody.innerHTML = ""; // Clear the loading row

                    data.players.forEach((player) => {
                        const row = `
                            <tr>
                                <td>${player.name}</td>
                                <td>${player.position}</td>
                                <td>${player.nationality}</td>
                                <td>${player.dateOfBirth ? calculateAge(player.dateOfBirth) : "N/A"}</td>
                            </tr>
                        `;
                        playerTableBody.innerHTML += row;
                    });
                } else {
                    playerTableBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="text-center">No players found for this team.</td>
                        </tr>
                    `;
                }
            })
            .catch((error) => {
                console.error("Error fetching players:", error);
                playerTableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center text-danger">Failed to load players.</td>
                    </tr>
                `;
            });
    });

    // Helper function to calculate age from date of birth
    function calculateAge(dob) {
        const birthDate = new Date(dob);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const m = today.getMonth() - birthDate.getMonth();
        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
            age--;
        }
        return age;
    }
});

</script>
{% endblock %}

















































{% extends 'contests/base.html' %}

{% load static %}

{% block title %}Team Selection{% endblock %}

{% block content %}
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1050;" id="toastContainer">
</div>

<!-- Modal -->
<div id="leagueOptionsModal" class="modal fade" tabindex="-1" aria-labelledby="leagueOptionsModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"> <!-- Centered modal -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="leagueOptionsModalLabel">What would you like to do next?</h5>
                <button type="button" class="btn-close" id="dismissButton" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>You can either create a new league and invite your friends or join an existing league to compete.</p>
            </div>
            <div class="modal-footer">
                <a href="/api/create-league/" class="btn btn-primary"
                    style="background: linear-gradient(to right, #00ffc6, #007bff); color: white;">Create League</a>
                <a href="/api/league/" class="btn btn-secondary">Join League</a>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    <!-- Card Container -->
    <div class="p-4 rounded shadow-sm" style="background: linear-gradient(to right, #00ffc6, #007bff); color: white;">
        <!-- Card Content -->
        <div class="row row-cols-1 row-cols-md-2 g-4"> <!-- Bootstrap responsive classes for gaps -->
            <!-- Left Section -->
            <div class="col">
                <div class="rounded p-4 d-flex flex-column h-100"
                    style="background: linear-gradient(to left, #00ffc6, #007bff); min-height: 200px;">

                    <!-- Image and Text -->
                    <div class="d-flex align-items-center flex-nowrap">
                        <img src="{% static 'images/gaolpost-1.png' %}" alt="Goal Post" class="me-3"
                            style="width: 60px; height: 60px; border-radius: 50%;">
                        <div>
                            <h3 class="fw-bold mb-1 text-dark">{{ user_team.name }}</h3>
                            <h3 class="fw-bold mb-1 text-dark" id="teamName" style="display: none;">{{ user_team.name
                                }}#{{ user_team.id }}</h3>
                            <p class="fw-bold mb-2 text-dark" style="font-size: 0.8rem;">{{ user_team.user.username }}
                            </p>
                        </div>
                    </div>

                    <!-- Total Points and Global Ranking -->
                    <div class="bg-dark text-white rounded p-3 mt-auto"> <!-- Added mt-auto to push content down -->
                        <div class="row d-flex align-items-center">
                            <!-- Total Points Section -->
                            <div class="col-4 text-center d-flex flex-column align-items-center justify-content-center">
                                <h1 class="fw-bold mb-0">0</h1> <!-- Added mb-0 for tighter spacing -->
                                <p class="text-muted">Total Points</p>
                            </div>
                            <!-- Global Rank and Highest Points Section -->
                            <div class="col-8">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Global rank</span>
                                    <span>-</span>
                                </div>
                                <hr class="fade-hr my-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Highest points</span>
                                    <span>-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Right Section -->
            <div class="col">
                <div class="rounded p-4 d-flex flex-column h-100"
                    style="background: linear-gradient(to left, #00ffc6, #007bff); min-height: 200px;">
                    <h4 class="fw-bold  text-dark" style="font-size: 1.0rem;">Gameweek 21 Challenge</h4>
                    <h5 class="fw-bold  text-dark">Legends</h5>
                    <p class="text-dark">âš¡ Players who have been at their club for 5+ seasons earn double points</p>
                    <div class="d-flex justify-content-between mt-auto"> <!-- Added mt-auto to align inner boxes -->
                        <div class="p-3 rounded shadow-sm d-flex justify-content-between align-items-center"
                            style="background-color: #e8fff4; width: 100%; opacity: 0.8;">
                            <span class="text-dark" style="font-size: 0.8rem;">Players selected</span>
                            <div>
                                <span class="fw-bold text-dark">
                                    <span id="budgetDisplay">100.0m</span>
                                    <span class="text-dark" style="font-size: 0.8rem;">Remaining budget</span>
                                </span>
                            </div>

                            <span class="fw-bold text-dark">Unlimited</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div id="playerModal" class="modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
            <div class="modal-content"
                style="background: linear-gradient(to right, #00ffc6, #007bff); width: 90%; max-width: 600px; margin: 10% auto; padding: 20px; border-radius: 15px; color: white; text-align: center; position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">

                <!-- Close Button -->
                <button id="closeModalButton"
                    style="position: absolute; top: 10px; right: 20px; background: transparent; color: white; border: none; font-size: 1.5rem; cursor: pointer;">
                    X
                </button>

                <!-- Player Information -->
                <div class="d-flex align-items-center" style="flex-direction: column;">
                    <!-- Player Image -->
                    <img id="modalPlayerImage" src="" alt=""
                        style="width: 120px; height: 120px; border-radius: 50%; margin-bottom: 20px;">
                    <!-- Player Name and Position -->
                    <h3 id="modalPlayerName" style="margin: 0; font-size: 1.5rem;"></h3>
                    <p id="modalPlayerPosition" style="margin: 0; font-size: 1rem;">Midfielder</p>
                    <!-- Player Team -->
                    <p id="modalPlayerTeam" style="font-size: 1rem; color: #f9e000;">Brentford</p>
                </div>

                <!-- Stats Section -->
                <div class="d-flex justify-content-between align-items-center"
                    style="margin: 20px 0; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">Price</p>
                        <h4 id="modalPlayerPrice" style="margin: 5px 0;">7.8m</h4>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">Form</p>
                        <h4 id="modalPlayerForm" style="margin: 5px 0;">8.0</h4>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">TSB%</p>
                        <h4 id="modalPlayerTSB" style="margin: 5px 0;">5.43%</h4>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex justify-content-around">
                    <button class="btn btn-light"
                        style="padding: 10px 20px; border-radius: 20px; font-weight: bold; background: #1dcdfd; color: white; border: none;">
                        Make Captain
                    </button>
                    <button class="btn btn-light"
                        style="padding: 10px 20px; border-radius: 20px; font-weight: bold; background: #8e44ad; color: white; border: none;">
                        Transfer Out
                    </button>
                </div>
            </div>
        </div>


        <!-- Pitch Area bg-success -->
        <div class="col-md-8">
            <div class="position-relative rounded">
                <img src="{% static 'images/pitch.png' %}" alt="Pitch" class="img-fluid w-100 rounded">
                <div id="pitch-formation">
                    <!-- Formation players will be dynamically injected here -->
                </div>
            </div>
            <!-- Button Section -->
            <div class="container mt-3">
                <div class="row g-3 justify-content-center align-items-center">
                    <!-- Formation Dropdown -->
                    <div class="col-12 col-md-auto d-flex align-items-center bg-light border rounded p-3">
                        <label for="formation-select" style="font-size: 16px; margin-right: 8px;">Choose
                            formation</label>
                        <select id="formation-select" class="form-select form-select-lg" style="width: 150px;">
                            <option value="1-1-2">1-1-2</option>
                            <option value="4-4-2">4-4-2</option>
                            <option value="4-3-3">4-3-3</option>
                            <option value="3-5-2">3-5-2</option>
                            <option value="5-3-2">5-3-2</option>
                        </select>
                    </div>

                    <!-- Buttons -->
                    <div class="col-12 col-md-auto">
                        <button id="resetButton" class="btn btn-outline-secondary btn-lg w-100 mb-2 mb-md-0"
                            style="padding: 10px 20px;">Reset</button>
                    </div>
                    <div class="col-12 col-md-auto">
                        <button class="btn btn-outline-secondary btn-lg w-100 mb-2 mb-md-0" id="autoPickButton"
                            style="padding: 10px 20px;">
                            Auto pick
                        </button>
                    </div>
                    <div class="col-12 col-md-auto">
                        <button id="saveTeamButton" class="btn btn-primary btn-lg w-100"
                            style="background: linear-gradient(to right, #00ffc6, #007bff); color: rgb(255, 255, 255); padding: 10px 30px;">Save
                            team</button>
                    </div>

                </div>
            </div>
            <!-- Add the fixtures section below -->
            <div class="mt-4 bg-light rounded p-3">
                <h4 class="text-center fw-bold text-uppercase mb-3">Gameweek 21 Fixtures</h4>
                <p class="text-center text-muted">Final Deadline <strong>Thu 16 Jan 23:00</strong></p>
                <div class="text-center mb-3">
                    <button class="btn btn-primary">Deadlines explained</button>
                </div>
                <h5 class="fw-bold text-dark">Tuesday 14 January 2025</h5>
                <div class="timeline mt-3">
                    <!-- Match 1 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/brentford.png' %}" alt="Brentford" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Brentford</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Man City</span>
                                <img src="{% static 'images/man_city.png' %}" alt="Man City" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 2 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/chelsea.png' %}" alt="Chelsea" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Chelsea</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Bournemouth</span>
                                <img src="{% static 'images/bournemouth.png' %}" alt="Bournemouth" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 3 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/west_ham.png' %}" alt="West Ham" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>West Ham</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Fulham</span>
                                <img src="{% static 'images/fulham.png' %}" alt="Fulham" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 4 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/nottm_forest.png' %}" alt="Nott'm Forest" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Nott'm Forest</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Liverpool</span>
                                <img src="{% static 'images/liverpool.png' %}" alt="Liverpool" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 5 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/everton.png' %}" alt="Everton" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Everton</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Aston Villa</span>
                                <img src="{% static 'images/aston_villa.png' %}" alt="Aston Villa" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 6 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/leicester.png' %}" alt="Leicester" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Leicester</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Crystal Palace</span>
                                <img src="{% static 'images/crystal_palace.png' %}" alt="Crystal Palace"
                                    class="img-fluid" style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>
                </div>
            </div>

            <!-- Fixtures Section -->
            <div class="mt-4 bg-light rounded p-3">
                <h4 class="text-center fw-bold text-uppercase mb-3">Gameweek Fixtures</h4>
                <p class="text-center text-muted">Real-Time Matches</p>
                <div class="timeline mt-3">
                    {% for match in matches %}
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">{{ match.formatted_time }}</span>
                            <p class="text-muted small">{{ match.formatted_date }}</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{{ match.homeTeam.logo }}" alt="{{ match.homeTeam.name }}" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>{{ match.homeTeam.name }}</span>
                            </div>
                            <span class="fw-bold mx-3">vs</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>{{ match.awayTeam.name }}</span>
                                <img src="{{ match.awayTeam.logo }}" alt="{{ match.awayTeam.name }}" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>
                    {% endfor %}
                </div>
            </div>

            <select class="form-select mb-3" id="teamSelect">
                <option value="">Select a team...</option>
            </select>

            <table class="table table-striped table-bordered align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Player</th>
                        <th>Position</th>
                        <th>Nationality</th>
                        <th>Age</th>
                    </tr>
                </thead>
                <tbody id="playerTableBody">
                    <tr>
                        <td colspan="4" class="text-center">Select a team to view players.</td>
                    </tr>
                </tbody>
            </table>
            
        </div>

        <!-- Player Selection -->
        <div class="col-md-4">
            <div class="bg-white p-4 rounded shadow-sm">
                <h5 class="fw-bold">Player Selection</h5>
                <input type="text" class="form-control mb-3" placeholder="Search for player...">
                <select class="form-select mb-3">
                    <option>View</option>
                    <option>Defenders</option>
                    <option>Midfielders</option>
                </select>
                <select class="form-select mb-3">
                    <option>Sorted by</option>
                    <option>Total points</option>
                    <option>Price</option>
                </select>
                <p class="fw-bold mb-1">Max cost: Between 3.9 and 7.2</p>
                <div class="d-flex justify-content-between">
                    <span>7.2</span>
                    <input type="range" class="form-range">
                </div>
                <div class="form-check mt-3">
                    <input class="form-check-input" type="checkbox" id="fiveSeasons">
                    <label class="form-check-label" for="fiveSeasons">
                        Show Players who have been at their club for 5+ seasons
                    </label>
                </div>
                <button class="btn btn-primary w-100 mt-3">207 players shown</button>

                <!-- Goalkeepers Section -->
                <h5 class="fw-bold text-dark mt-4">Goalkeepers</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="Aaron Ramsdale"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Goalkeeper">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Aaron Ramsdale</span><br>
                                        <small class="text-muted">ARS GKP</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">123</td>
                            <td class="fw-bold text-center">20.5m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="David Raya"
                            data-image="{% static 'images/palmer.png' %}" data-position="Goalkeeper">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">David Raya</span><br>
                                        <small class="text-muted">ARS GKP</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-warning">MCI (A)</span></td>
                            <td class="text-center">97</td>
                            <td class="fw-bold text-center">40.0m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Defenders Section -->
                <h5 class="fw-bold text-dark mt-4">Defenders</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="William Saliba"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Defender">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">William Saliba</span><br>
                                        <small class="text-muted">ARS DEF</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-danger">LIV (A)</span></td>
                            <td class="text-center">110</td>
                            <td class="fw-bold text-center">50.2m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="Oleksandr Zinchenko"
                            data-image="{% static 'images/palmer.png' %}" data-position="Defender">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Oleksandr Zinchenko</span><br>
                                        <small class="text-muted">ARS DEF</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">102</td>
                            <td class="fw-bold text-center">52.0m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Midfielders Section -->
                <h5 class="fw-bold text-dark mt-4">Midfielders</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="Martin Degaard"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Midfielder">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Martin Degaard</span><br>
                                        <small class="text-muted">ARS MID</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-warning">MUN (H)</span></td>
                            <td class="text-center">140</td>
                            <td class="fw-bold text-center">6.8m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="Bukayo Saka"
                            data-image="{% static 'images/palmer.png' %}" data-position="Midfielder">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Bukayo Saka</span><br>
                                        <small class="text-muted">ARS MID</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">152</td>
                            <td class="fw-bold text-center">8.3m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Forwards Section -->
                <h5 class="fw-bold text-dark mt-4">Forwards</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <th>Opponent</th>
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="player-selection-row" data-name="Gabriel Jesus"
                            data-image="{% static 'images/m_salah.png' %}" data-position="Forward">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/m_salah.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Gabriel Jesus</span><br>
                                        <small class="text-muted">ARS FWD</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-warning">MUN (H)</span></td>
                            <td class="text-center">87</td>
                            <td class="fw-bold text-center">8.0m</td>
                        </tr>
                        <tr class="player-selection-row" data-name="Eddie Nketiah"
                            data-image="{% static 'images/palmer.png' %}" data-position="Forward">
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{% static 'images/palmer.png' %}" alt="Player" style="width: 40px;"
                                        class="me-3 rounded-circle">
                                    <div>
                                        <span class="fw-bold">Eddie Nketiah</span><br>
                                        <small class="text-muted">ARS FWD</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge text-bg-success">AVL (H)</span></td>
                            <td class="text-center">65</td>
                            <td class="fw-bold text-center">6.4m</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Pagination Controls -->
                <div class="d-flex justify-content-between align-items-center mt-4">
                    <span>1 of 20</span>
                    <div>
                        <button class="btn btn-light me-2"><i class="fas fa-chevron-left"></i></button>
                        <button class="btn btn-light"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

<!-- Auto Pitch -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Define formations and their respective positions
        const formations = {
            "1-1-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "45%", left: "50%" },
                { position: "Midfielder", top: "77%", left: "32%" },
                { position: "Midfielder", top: "77%", left: "67%" },
            ],
            "4-4-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "25%", left: "20%" },
                { position: "Defender", top: "25%", left: "40%" },
                { position: "Defender", top: "25%", left: "60%" },
                { position: "Defender", top: "25%", left: "80%" },
                { position: "Midfielder", top: "50%", left: "20%" },
                { position: "Midfielder", top: "50%", left: "40%" },
                { position: "Midfielder", top: "50%", left: "60%" },
                { position: "Midfielder", top: "50%", left: "80%" },
                { position: "Forward", top: "77%", left: "32%" },
                { position: "Forward", top: "77%", left: "67%" },
            ],
        };

        // Define available players with prices
        const players = [
            { name: "Aaron Ramsdale", position: "Goalkeeper", price: 4.5, image: "{% static 'images/m_salah.png' %}" },
            { name: "David Raya", position: "Goalkeeper", price: 4.8, image: "{% static 'images/m_salah.png' %}" },
            { name: "Ben White", position: "Defender", price: 5.0, image: "{% static 'images/m_salah.png' %}" },
            { name: "William Saliba", position: "Defender", price: 5.5, image: "{% static 'images/m_salah.png' %}" },
            { name: "Oleksandr Zinchenko", position: "Defender", price: 5.2, image: "{% static 'images/m_salah.png' %}" },
            { name: "Gabriel Magalhaes", position: "Defender", price: 5.0, image: "{% static 'images/m_salah.png' %}" },
            { name: "Martin Degaard", position: "Midfielder", price: 6.8, image: "{% static 'images/m_salah.png' %}" },
            { name: "Declan Rice", position: "Midfielder", price: 5.9, image: "{% static 'images/m_salah.png' %}" },
            { name: "Bukayo Saka", position: "Forward", price: 8.3, image: "{% static 'images/m_salah.png' %}" },
            { name: "Gabriel Jesus", position: "Forward", price: 8.0, image: "{% static 'images/m_salah.png' %}" },
        ];

        const formationSelect = document.getElementById("formation-select");
        const pitchFormation = document.getElementById("pitch-formation");
        const autoPickButton = document.getElementById("autoPickButton");
        const budgetDisplay = document.getElementById("budgetDisplay");

        let totalBudget = 100.0; // Total available budget
        let remainingBudget = totalBudget; // Remaining budget

        // Update the budget display
        function updateBudgetDisplay() {
            budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
        }

        // Function to render a formation
        function renderFormation(formationKey) {
            pitchFormation.innerHTML = ""; // Clear the pitch
            const formation = formations[formationKey];

            if (formation) {
                formation.forEach((position) => {
                    const positionDiv = document.createElement("div");
                    positionDiv.className = "position-absolute text-center";
                    positionDiv.style.top = position.top;
                    positionDiv.style.left = position.left;
                    positionDiv.style.transform = "translate(-50%, -50%)";
                    positionDiv.innerHTML = `
                    <div class="bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center" 
                        style="width: 50px; height: 50px;">
                        ${position.position}
                    </div>
                `;
                    pitchFormation.appendChild(positionDiv);
                });
            }
        }

        // Auto-pick players while considering the budget
        function autoPickPlayers(formationKey) {
            const formation = formations[formationKey];
            if (!formation) {
                console.error("Formation not found:", formationKey);
                return;
            }

            const shuffledPlayers = [...players].sort(() => 0.5 - Math.random());
            remainingBudget = totalBudget; // Reset budget
            updateBudgetDisplay(); // Update budget display
            pitchFormation.innerHTML = ""; // Clear the pitch

            formation.forEach((position) => {
                const player = shuffledPlayers.find((p) => p.position === position.position && p.price <= remainingBudget);
                if (player) {
                    const playerDiv = document.createElement("div");
                    playerDiv.className = "position-absolute text-center";
                    playerDiv.style.top = position.top;
                    playerDiv.style.left = position.left;
                    playerDiv.style.transform = "translate(-50%, -50%)";

                    playerDiv.innerHTML = `
                        <div class="rounded text-center shadow-sm player-card" 
                            style="width: 50px;  font-family: Arial, sans-serif; cursor: pointer;"  
                            data-name="${player.name}" 
                            data-image="${player.image}" 
                            data-position="${player.position}" 
                            data-price="${player.price}">

                            <div class="bg-success d-flex justify-content-center align-items-center" style="padding-top: 5px;border-top-left-radius: 10px; border-top-right-radius: 10px; padding: 5px;">
                                <img src="${player.image}" alt="${player.name.split(" ")[0]}" 
                                    style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                            </div>

                            <div class="bg-light" 
                                style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                                ${player.name.split(" ")[0]}
                            </div>

                        </div>
                    `;

                    // Add click event to open the modal
                    playerDiv.querySelector(".player-card").addEventListener("click", function () {
                        showPlayerModal(
                            this.getAttribute("data-name"),
                            this.getAttribute("data-image"),
                            this.getAttribute("data-position")
                        );
                    });

                    pitchFormation.appendChild(playerDiv);

                    // Deduct the player's price from the budget
                    remainingBudget -= player.price;
                    updateBudgetDisplay();
                }
            });
        }

        function showPlayerModal(name, image, position) {
            const modal = document.getElementById("playerModal");
            document.getElementById("modalPlayerName").textContent = name;
            document.getElementById("modalPlayerImage").src = image;
            document.getElementById("modalPlayerPosition").textContent = position;
            modal.style.display = "block";
        }

        document.getElementById("closeModalButton").addEventListener("click", function () {
            document.getElementById("playerModal").style.display = "none";
        });

        document.getElementById("playerModal").addEventListener("click", function (e) {
            if (e.target === this) {
                this.style.display = "none";
            }
        });

        // Event listener for formation dropdown change
        formationSelect.addEventListener("change", function () {
            renderFormation(this.value);
        });

        // Event listener for Auto-Pick button
        autoPickButton.addEventListener("click", function () {
            autoPickPlayers(formationSelect.value); // Trigger auto-pick based on the current formation
        });

        // Render default formation on load
        renderFormation("1-1-2");
        updateBudgetDisplay(); // Initialize budget display
    });

</script>

<!-- Manual $ Reset -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const formations = {
            "1-1-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "45%", left: "50%" },
                { position: "Midfielder", top: "77%", left: "32%" },
                { position: "Midfielder", top: "77%", left: "67%" },
            ],
            "4-4-2": [
                { position: "Goalkeeper", top: "10%", left: "50%" },
                { position: "Defender", top: "25%", left: "20%" },
                { position: "Defender", top: "25%", left: "40%" },
                { position: "Defender", top: "25%", left: "60%" },
                { position: "Defender", top: "25%", left: "80%" },
                { position: "Midfielder", top: "50%", left: "20%" },
                { position: "Midfielder", top: "50%", left: "40%" },
                { position: "Midfielder", top: "50%", left: "60%" },
                { position: "Midfielder", top: "50%", left: "80%" },
                { position: "Forward", top: "77%", left: "32%" },
                { position: "Forward", top: "77%", left: "67%" },
            ],
        };

        const pitchFormation = document.getElementById("pitch-formation");
        const formationSelect = document.getElementById("formation-select");
        const resetButton = document.getElementById("resetButton");
        const playerSelectionRows = document.querySelectorAll(".player-selection-row");

        const maxBudget = 100; // Example budget in millions
        let remainingBudget = maxBudget; // Track the remaining budget
        let currentTotalPrice = 0; // Track the total price of added players

        let selectedPositionElement = null; // Track the currently selected position

        // Function to render a formation
        function renderFormation(formationKey) {
            pitchFormation.innerHTML = ""; // Clear the pitch
            const formation = formations[formationKey];

            if (formation) {
                formation.forEach((position, index) => {
                    const positionDiv = document.createElement("div");
                    positionDiv.className = "pitch-position position-absolute text-center";
                    positionDiv.style.top = position.top;
                    positionDiv.style.left = position.left;
                    positionDiv.style.transform = "translate(-50%, -50%)";
                    positionDiv.setAttribute("data-index", index);

                    positionDiv.innerHTML = `
                    <div class="bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center" 
                        style="width: 50px; height: 50px; cursor: pointer;">
                        ${position.position}
                    </div>
                `;

                    // Event listener for manual assignment
                    positionDiv.addEventListener("click", function () {
                        selectedPositionElement = positionDiv; // Store the clicked position
                        highlightPosition(selectedPositionElement);
                    });

                    pitchFormation.appendChild(positionDiv);
                });
            }
        }

        // Highlight the selected position
        function highlightPosition(positionDiv) {
            document.querySelectorAll(".pitch-position").forEach((div) => {
                div.style.border = ""; // Reset border for all positions
            });
            if (positionDiv) {
                positionDiv.style.border = "2px dashed green"; // Highlight the selected position Remaining Budget: Ksh
            }
        }

        // Update the displayed budget
        function updateBudgetDisplay() {
            const budgetDisplay = document.getElementById("budgetDisplay");
            budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
        }

        // Assign a player to the selected position
        function assignPlayerToPosition(player, price) {
            if (!selectedPositionElement) {
                showToast("Please select a position on the pitch first!", "danger");
                return;
            }

            if (price > remainingBudget) {
                showToast("Insufficient budget to add this player!", "danger");
                return;
            }

            if (currentTotalPrice + price > maxBudget) {
                showToast("Adding this player exceeds the total budget!", "danger");
                return;
            }

            // Deduct the player's price from the remaining budget and add to the total price
            remainingBudget -= price;
            currentTotalPrice += price;
            updateBudgetDisplay();

            selectedPositionElement.innerHTML = `
            <div class="rounded text-center shadow-sm player-card" 
                style="width: 50px; font-family: Arial, sans-serif; cursor: pointer;"
                data-name="${player.name}"
                data-image="${player.image}"
                data-position="${player.position}"
                data-price="${price}">

                <div class="bg-success d-flex justify-content-center align-items-center" 
                    style="padding: 5px; border-top-left-radius: 10px; border-top-right-radius: 10px;">
                    <img src="${player.image}" alt="${player.name}" 
                        style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                </div>
                <div class="bg-light" 
                    style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; 
                    border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                    ${player.name.split(" ")[0]}
                </div>
            </div>
        `;

            // Add click event to the new player card for modal functionality
            selectedPositionElement.querySelector(".player-card").addEventListener("click", function (e) {
                e.stopPropagation(); // Prevent event bubbling
                showPlayerModal(player.name, player.image, player.position);
            });

            highlightPosition(null); // Reset the highlight
            selectedPositionElement = null; // Clear selected position
        }

        // Show modal with player details
        function showPlayerModal(name, image, position) {
            const modal = document.getElementById("playerModal");
            document.getElementById("modalPlayerName").textContent = name;
            document.getElementById("modalPlayerImage").src = image;
            document.getElementById("modalPlayerPosition").textContent = position;
            modal.style.display = "block";
        }

        // Close the modal
        document.getElementById("closeModalButton").addEventListener("click", function () {
            document.getElementById("playerModal").style.display = "none";
        });

        document.getElementById("playerModal").addEventListener("click", function (e) {
            if (e.target === this) {
                this.style.display = "none";
            }
        });

        // Attach event listeners to player selection rows
        playerSelectionRows.forEach((row) => {
            row.addEventListener("click", function () {
                const player = {
                    name: this.getAttribute("data-name"),
                    image: this.getAttribute("data-image"),
                    position: this.getAttribute("data-position"),
                };

                const priceText = this.querySelector("td:nth-child(4)").textContent.trim(); // Extract price from 4th column
                const price = parseFloat(priceText.replace("m", ""));

                assignPlayerToPosition(player, price);
            });
        });

        // Reset button event listener
        resetButton.addEventListener("click", function () {
            renderFormation(formationSelect.value); // Re-render formation without players
            remainingBudget = maxBudget; // Reset budget
            currentTotalPrice = 0; // Reset total price
            updateBudgetDisplay();
        });

        // Event listener for formation dropdown change
        formationSelect.addEventListener("change", function () {
            renderFormation(this.value);
        });

        // Render default formation on load
        renderFormation("1-1-2");

        // Initialize budget display
        updateBudgetDisplay();
    });

</script>

<!-- Showing Toast -->
<script>
    function showToast(message, type = "danger") {
        const toastContainer = document.getElementById("toastContainer");

        // Create the toast element
        const toast = document.createElement("div");
        toast.className = `toast align-items-center text-white bg-${type} border-0`;
        toast.setAttribute("role", "alert");
        toast.setAttribute("aria-live", "assertive");
        toast.setAttribute("aria-atomic", "true");
        toast.setAttribute("data-bs-autohide", "true");
        toast.setAttribute("data-bs-delay", "3000");

        // Add the toast content
        toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    `;

        // Append the toast to the container
        toastContainer.appendChild(toast);

        // Initialize the toast using Bootstrap's JS
        const bootstrapToast = new bootstrap.Toast(toast);
        bootstrapToast.show();

        // Remove the toast from the DOM after it hides
        toast.addEventListener("hidden.bs.toast", () => {
            toast.remove();
        });
    }

</script>

<!-- Team Saving -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const saveTeamButton = document.getElementById("saveTeamButton");

        // Fetch team status on page load
        fetch("/api/check-team-status/", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((response) => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error("Failed to fetch team status.");
            })
            .then((data) => {
                if (data.team_exists) {
                    // Disable the save button if the team already exists
                    saveTeamButton.disabled = true;
                    saveTeamButton.textContent = "Team Saved";
                    saveTeamButton.classList.add("btn-secondary"); // Optional: Update button styling
                    saveTeamButton.classList.remove("btn-primary");

                    // Disable the Auto Pick and Reset buttons
                    autoPickButton.disabled = true;
                    autoPickButton.classList.add("btn-secondary"); // Optional: Update styling
                    autoPickButton.classList.remove("btn-outline-secondary");

                    resetButton.disabled = true;
                    resetButton.classList.add("btn-secondary"); // Optional: Update styling
                    resetButton.classList.remove("btn-outline-secondary");
                }
            })
            .catch((error) => {
                console.error("Error fetching team status:", error);
            });

        // Save Team Button Event Listener
        saveTeamButton.addEventListener("click", function () {
            const pitchPositions = document.querySelectorAll(".position-absolute .player-card");
            const teamData = [];
            const teamName = document.getElementById("teamName").textContent.trim();

            pitchPositions.forEach((playerCard) => {
                if (playerCard) {
                    const positionContainer = playerCard.parentElement; // Get parent container (position-absolute)
                    const positionCoordinates = {
                        top: positionContainer.style.top,
                        left: positionContainer.style.left,
                    };

                    const playerData = {
                        name: playerCard.getAttribute("data-name"),
                        position: playerCard.getAttribute("data-position"),
                        team: playerCard.getAttribute("data-team") || "Unknown",
                        formation_name: document.getElementById("formation-select").value,
                        score: parseInt(playerCard.getAttribute("data-score") || "0"),
                        position_coordinates: JSON.stringify(positionCoordinates), // Add coordinates as JSON string
                    };
                    teamData.push(playerData);
                }
            });


            if (teamData.length === 0) {
                showToast("No players selected to save.", "danger");
                return;
            }

            // Send the team data to the backend
            fetch("/api/save-team/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": getCSRFToken(),
                },
                body: JSON.stringify({ team_name: teamName, team: teamData }), // Ensure payload matches backend expectation
            })
                .then((response) => {
                    // console.log("Response status:", response.status); // Debug log
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error("Failed to save team.");
                })
                .then((data) => {
                    // Show success toast and disable button
                    showToast(data.message || "Team saved successfully!", "success");
                    saveTeamButton.disabled = true;
                    saveTeamButton.textContent = "Team Saved";
                    saveTeamButton.classList.add("btn-secondary");
                    saveTeamButton.classList.remove("btn-primary");

                    // Disable the Auto Pick and Reset buttons
                    autoPickButton.disabled = true;
                    autoPickButton.classList.add("btn-secondary"); // Optional: Update styling
                    autoPickButton.classList.remove("btn-outline-secondary");

                    resetButton.disabled = true;
                    resetButton.classList.add("btn-secondary"); // Optional: Update styling
                    resetButton.classList.remove("btn-outline-secondary");

                    // Show the modal
                    const leagueOptionsModal = new bootstrap.Modal(document.getElementById("leagueOptionsModal"));
                    leagueOptionsModal.show();

                    // Redirect to a new page after success
                    // window.location.href = "/api/manageteam/"; 
                })
                .catch((error) => {
                    console.error(error);
                    showToast("Error saving team. Please try again.", "danger");
                });
        });

        const dismissButton = document.getElementById("dismissButton");

        dismissButton.addEventListener("click", function () {
            // Redirect to /api/manageteam/
            window.location.href = "/api/manageteam/";
        });


        // Helper function to get CSRF token
        function getCSRFToken() {
            const csrfTokenElement = document.querySelector('[name=csrfmiddlewaretoken]');
            return csrfTokenElement ? csrfTokenElement.value : "";
        }

        // Helper function to show toast messages
        function showToast(message, type) {
            const toastContainer = document.getElementById("toastContainer");
            if (!toastContainer) {
                console.error("Toast container not found.");
                return;
            }

            const toast = document.createElement("div");
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.role = "alert";
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            toastContainer.appendChild(toast);

            const bootstrapToast = new bootstrap.Toast(toast);
            bootstrapToast.show();

            toast.addEventListener("hidden.bs.toast", () => {
                toastContainer.removeChild(toast);
            });
        }

    });
</script>

<!-- Get the saved players -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const pitchFormation = document.getElementById("pitch-formation");
        const budgetDisplay = document.getElementById("budgetDisplay");
        const totalBudget = 100.0; // Initial budget

        // Function to update the budget display
        function updateBudgetDisplay(remainingBudget) {
            budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
        }

        // Function to render saved players on the pitch
        function renderSavedPlayers(savedTeam) {
            pitchFormation.innerHTML = ""; // Clear the pitch
            let totalPlayerPrice = 0;

            savedTeam.forEach((player) => {
                const positionDiv = document.createElement("div");
                positionDiv.className = "position-absolute text-center";
                positionDiv.style.transform = "translate(-50%, -50%)";

                // Parse the position coordinates from the data
                const coordinates = JSON.parse(player.position_coordinates || "{}");
                positionDiv.style.top = coordinates.top;
                positionDiv.style.left = coordinates.left;

                positionDiv.innerHTML = `
                    <div class="rounded text-center shadow-sm player-card" 
                        style="width: 50px; font-family: Arial, sans-serif; cursor: pointer;"  
                        data-name="${player.name}" 
                        data-position="${player.position}" 
                        data-price="${player.price}" 
                        data-image="${player.image || '{% static "images/m_salah.png" %}'}">

                        <div class="bg-success d-flex justify-content-center align-items-center" 
                            style="padding: 5px; border-top-left-radius: 10px; border-top-right-radius: 10px;">
                            <img src="${player.image || '{% static "images/m_salah.png" %}'}" alt="${player.name}" 
                                style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                        </div>

                        <div class="bg-light" 
                            style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; 
                            border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                            ${player.name.split(" ")[0]}
                        </div>
                    </div>
                `;

                // Attach click event listener to open modal
                positionDiv.querySelector(".player-card").addEventListener("click", function () {
                    const name = this.getAttribute("data-name");
                    const image = this.getAttribute("data-image");
                    const position = this.getAttribute("data-position");

                    showPlayerModal(name, image, position);
                });

                pitchFormation.appendChild(positionDiv);

                // Add the player's price to the total
                totalPlayerPrice += parseFloat(player.price) || 0;
            });
            // Calculate remaining budget and update the display
            const remainingBudget = totalBudget - totalPlayerPrice;
            updateBudgetDisplay(remainingBudget);
            console.log(totalPlayerPrice)
        }

        // Fetch saved players and render them on the pitch
        fetch("/api/get-saved-team/", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((response) => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error("Failed to fetch saved team.");
            })
            .then((data) => {
                if (data.team && data.team.length > 0) {
                    renderSavedPlayers(data.team); // Render players
                }
            })
            .catch((error) => {
                console.error("Error loading saved team:", error);
            });

        // Function to show modal with player details
        function showPlayerModal(name, image, position) {
            const modal = document.getElementById("playerModal");
            document.getElementById("modalPlayerName").textContent = name;
            document.getElementById("modalPlayerImage").src = image || "default-image.png"; // Fallback if no image
            document.getElementById("modalPlayerPosition").textContent = position || "Unknown";
            modal.style.display = "block";
        }

        // Close the modal
        document.getElementById("closeModalButton").addEventListener("click", function () {
            document.getElementById("playerModal").style.display = "none";
        });

        document.getElementById("playerModal").addEventListener("click", function (e) {
            if (e.target === this) {
                this.style.display = "none";
            }
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
    const teamSelect = document.getElementById("teamSelect");
    const playerTableBody = document.getElementById("playerTableBody");

    // Fetch and populate teams
    fetch("/api/get-teams/")
        .then((response) => response.json())
        .then((data) => {
            if (data.teams) {
                data.teams.forEach((team) => {
                    const option = document.createElement("option");
                    option.value = team.id; // Use team ID as the value
                    option.textContent = team.name; // Display team name
                    teamSelect.appendChild(option);
                });
            }
        })
        .catch((error) => console.error("Error fetching teams:", error));

    // Fetch and display players when a team is selected
    teamSelect.addEventListener("change", function () {
        const teamId = teamSelect.value;

        // Clear the player table
        playerTableBody.innerHTML = `
            <tr>
                <td colspan="4" class="text-center">Loading players...</td>
            </tr>
        `;

        // Fetch players for the selected team
        fetch(`/api/get-players-by-team/?team_id=${teamId}`)
            .then((response) => response.json())
            .then((data) => {
                if (data.players) {
                    playerTableBody.innerHTML = ""; // Clear the loading row

                    data.players.forEach((player) => {
                        const row = `
                            <tr>
                                <td>${player.name}</td>
                                <td>${player.position}</td>
                                <td>${player.nationality}</td>
                                <td>${player.dateOfBirth ? calculateAge(player.dateOfBirth) : "N/A"}</td>
                            </tr>
                        `;
                        playerTableBody.innerHTML += row;
                    });
                } else {
                    playerTableBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="text-center">No players found for this team.</td>
                        </tr>
                    `;
                }
            })
            .catch((error) => {
                console.error("Error fetching players:", error);
                playerTableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center text-danger">Failed to load players.</td>
                    </tr>
                `;
            });
    });

    // Helper function to calculate age from date of birth
    function calculateAge(dob) {
        const birthDate = new Date(dob);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const m = today.getMonth() - birthDate.getMonth();
        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
            age--;
        }
        return age;
    }
});

</script>
{% endblock %}









































{% extends 'contests/base.html' %}

{% load static %}

{% block title %}Team Selection{% endblock %}

{% block content %}
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1050;" id="toastContainer">
</div>

<!-- Modal -->
<div id="leagueOptionsModal" class="modal fade" tabindex="-1" aria-labelledby="leagueOptionsModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"> <!-- Centered modal -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="leagueOptionsModalLabel">What would you like to do next?</h5>
                <button type="button" class="btn-close" id="dismissButton" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>You can either create a new league and invite your friends or join an existing league to compete.</p>
            </div>
            <div class="modal-footer">
                <a href="/api/create-league/" class="btn btn-primary"
                    style="background: linear-gradient(to right, #00ffc6, #007bff); color: white;">Create League</a>
                <a href="/api/league/" class="btn btn-secondary">Join League</a>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    <!-- Card Container -->
    <div class="p-4 rounded shadow-sm" style="background: linear-gradient(to right, #00ffc6, #007bff); color: white;">
        <!-- Card Content -->
        <div class="row row-cols-1 row-cols-md-2 g-4"> <!-- Bootstrap responsive classes for gaps -->
            <!-- Left Section -->
            <div class="col">
                <div class="rounded p-4 d-flex flex-column h-100"
                    style="background: linear-gradient(to left, #00ffc6, #007bff); min-height: 200px;">

                    <!-- Image and Text -->
                    <div class="d-flex align-items-center flex-nowrap">
                        <img src="{% static 'images/gaolpost-1.png' %}" alt="Goal Post" class="me-3"
                            style="width: 60px; height: 60px; border-radius: 50%;">
                        <div>
                            <h3 class="fw-bold mb-1 text-dark">{{ user_team.name }}</h3>
                            <h3 class="fw-bold mb-1 text-dark" id="teamName" style="display: none;">{{ user_team.name
                                }}#{{ user_team.id }}</h3>
                            <p class="fw-bold mb-2 text-dark" style="font-size: 0.8rem;">{{ user_team.user.username }}
                            </p>
                        </div>
                    </div>

                    <!-- Points and Global Ranking -->
                    <div class="bg-dark text-white rounded p-3 mt-auto"> <!-- Added mt-auto to push content down -->
                        <div class="row d-flex align-items-center">
                            <!-- Points Section -->
                            <div class="col-4 text-center d-flex flex-column align-items-center justify-content-center">
                                <h1 class="fw-bold mb-0">0</h1> <!-- Added mb-0 for tighter spacing -->
                                <p class="text-muted">Points</p>
                            </div>
                            <!-- Global Rank and Highest Points Section -->
                            <div class="col-8">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Global rank</span>
                                    <span>-</span>
                                </div>
                                <hr class="fade-hr my-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Highest points</span>
                                    <span>-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Right Section -->
            <div class="col">
                <div class="rounded p-4 d-flex flex-column h-100"
                    style="background: linear-gradient(to left, #00ffc6, #007bff); min-height: 200px;">
                    <h4 class="fw-bold  text-dark" style="font-size: 1.0rem;">Gameweek 21 Challenge</h4>
                    <h5 class="fw-bold  text-dark">Legends</h5>
                    <p class="text-dark">âš¡ Players who have been at their club for 5+ seasons earn double points</p>
                    <div class="d-flex justify-content-between mt-auto"> <!-- Added mt-auto to align inner boxes -->
                        <div class="p-3 rounded shadow-sm d-flex justify-content-between align-items-center"
                            style="background-color: #e8fff4; width: 100%; opacity: 0.8;">
                            <span class="text-dark" style="font-size: 0.8rem;">Players selected</span>
                            <div>
                                <span class="fw-bold text-dark">
                                    <span id="budgetDisplay">100.0m</span>
                                    <span class="text-dark" style="font-size: 0.8rem;">Remaining budget</span>
                                </span>
                            </div>

                            <span class="fw-bold text-dark">Unlimited</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div id="playerModal" class="modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
            <div class="modal-content"
                style="background: linear-gradient(to right, #00ffc6, #007bff); width: 90%; max-width: 600px; margin: 10% auto; padding: 20px; border-radius: 15px; color: white; text-align: center; position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">

                <!-- Close Button -->
                <button id="closeModalButton"
                    style="position: absolute; top: 10px; right: 20px; background: transparent; color: white; border: none; font-size: 1.5rem; cursor: pointer;">
                    X
                </button>

                <!-- Player Information -->
                <div class="d-flex align-items-center" style="flex-direction: column;">
                    <!-- Player Image -->
                    <img id="modalPlayerImage" src="" alt=""
                        style="width: 120px; height: 120px; border-radius: 50%; margin-bottom: 20px;">
                    <!-- Player Name and Position -->
                    <h3 id="modalPlayerName" style="margin: 0; font-size: 1.5rem;"></h3>
                    <p id="modalPlayerPosition" style="margin: 0; font-size: 1rem;">Midfielder</p>
                    <!-- Player Team -->
                    <p id="modalPlayerTeam" style="font-size: 1rem; color: #f9e000;">Brentford</p>
                </div>

                <!-- Stats Section -->
                <div class="d-flex justify-content-between align-items-center"
                    style="margin: 20px 0; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">Price</p>
                        <h4 id="modalPlayerPrice" style="margin: 5px 0;">7.8m</h4>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">Form</p>
                        <h4 id="modalPlayerForm" style="margin: 5px 0;">8.0</h4>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <p style="margin: 0; font-size: 0.9rem;">TSB%</p>
                        <h4 id="modalPlayerTSB" style="margin: 5px 0;">5.43%</h4>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex justify-content-around">
                    <button class="btn btn-light"
                        style="padding: 10px 20px; border-radius: 20px; font-weight: bold; background: #1dcdfd; color: white; border: none;">
                        Make Captain
                    </button>
                    <button class="btn btn-light"
                        style="padding: 10px 20px; border-radius: 20px; font-weight: bold; background: #8e44ad; color: white; border: none;">
                        Transfer Out
                    </button>
                </div>
            </div>
        </div>


        <!-- Pitch Area bg-success -->
        <div class="col-md-8">
            <div class="position-relative rounded">
                <img src="{% static 'images/pitch.png' %}" alt="Pitch" class="img-fluid w-100 rounded">
                <div id="pitch-formation">
                    <!-- Formation players will be dynamically injected here -->
                </div>
            </div>
            <!-- Button Section -->
            <div class="container mt-3">
                <div class="row g-3 justify-content-center align-items-center">
                    <!-- Formation Dropdown -->
                    <div class="col-12 col-md-auto d-flex align-items-center bg-light border rounded p-3">
                        <label for="formation-select" style="font-size: 16px; margin-right: 8px;">Choose
                            formation</label>
                        <select id="formation-select" class="form-select form-select-lg" style="width: 150px;">
                            <option value="1-1-2">1-1-2</option>
                            <option value="4-4-2">4-4-2</option>
                            <option value="4-3-3">4-3-3</option>
                            <option value="3-5-2">3-5-2</option>
                            <option value="5-3-2">5-3-2</option>
                        </select>
                    </div>

                    <!-- Buttons -->
                    <div class="col-12 col-md-auto">
                        <button id="resetButton" class="btn btn-outline-secondary btn-lg w-100 mb-2 mb-md-0"
                            style="padding: 10px 20px;">Reset</button>
                    </div>
                    <div class="col-12 col-md-auto">
                        <button class="btn btn-outline-secondary btn-lg w-100 mb-2 mb-md-0" id="autoPickButton"
                            style="padding: 10px 20px;">
                            Auto pick
                        </button>
                    </div>
                    <div class="col-12 col-md-auto">
                        <button id="saveTeamButton" class="btn btn-primary btn-lg w-100"
                            style="background: linear-gradient(to right, #00ffc6, #007bff); color: rgb(255, 255, 255); padding: 10px 30px;">Save
                            team</button>
                    </div>

                </div>
            </div>
            <!-- Add the fixtures section below -->
            <div class="mt-4 bg-light rounded p-3">
                <h4 class="text-center fw-bold text-uppercase mb-3">Gameweek 21 Fixtures</h4>
                <p class="text-center text-muted">Final Deadline <strong>Thu 16 Jan 23:00</strong></p>
                <div class="text-center mb-3">
                    <button class="btn btn-primary">Deadlines explained</button>
                </div>
                <h5 class="fw-bold text-dark">Tuesday 14 January 2025</h5>
                <div class="timeline mt-3">
                    <!-- Match 1 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/brentford.png' %}" alt="Brentford" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Brentford</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Man City</span>
                                <img src="{% static 'images/man_city.png' %}" alt="Man City" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 2 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/chelsea.png' %}" alt="Chelsea" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Chelsea</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Bournemouth</span>
                                <img src="{% static 'images/bournemouth.png' %}" alt="Bournemouth" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 3 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/west_ham.png' %}" alt="West Ham" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>West Ham</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Fulham</span>
                                <img src="{% static 'images/fulham.png' %}" alt="Fulham" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 4 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/nottm_forest.png' %}" alt="Nott'm Forest" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Nott'm Forest</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Liverpool</span>
                                <img src="{% static 'images/liverpool.png' %}" alt="Liverpool" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 5 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/everton.png' %}" alt="Everton" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Everton</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Aston Villa</span>
                                <img src="{% static 'images/aston_villa.png' %}" alt="Aston Villa" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>

                    <!-- Match 6 -->
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">22:30</span>
                            <p class="text-muted small">Next deadline</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{% static 'images/leicester.png' %}" alt="Leicester" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>Leicester</span>
                            </div>
                            <span class="fw-bold mx-3">22:30</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>Crystal Palace</span>
                                <img src="{% static 'images/crystal_palace.png' %}" alt="Crystal Palace"
                                    class="img-fluid" style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>
                </div>
            </div>

            <!-- Fixtures Section -->
            <div class="mt-4 bg-light rounded p-3">
                <h4 class="text-center fw-bold text-uppercase mb-3">Gameweek Fixtures</h4>
                <p class="text-center text-muted">Real-Time Matches</p>
                <div class="timeline mt-3">
                    {% for match in matches %}
                    <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                        <div class="me-2 text-center">
                            <span class="fw-bold">{{ match.formatted_time }}</span>
                            <p class="text-muted small">{{ match.formatted_date }}</p>
                        </div>
                        <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                            <div class="d-flex align-items-center me-3">
                                <img src="{{ match.homeTeam.logo }}" alt="{{ match.homeTeam.name }}" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-right: 8px;">
                                <span>{{ match.homeTeam.name }}</span>
                            </div>
                            <span class="fw-bold mx-3">vs</span>
                            <div class="d-flex align-items-center ms-3">
                                <span>{{ match.awayTeam.name }}</span>
                                <img src="{{ match.awayTeam.logo }}" alt="{{ match.awayTeam.name }}" class="img-fluid"
                                    style="height: 24px; width: 24px; margin-left: 8px;">
                            </div>
                        </div>
                        <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                            style="height: 24px;">
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Team Selection -->
            <select class="form-select mb-3" id="teamSelect">
                <option value="">Select a team...</option>
            </select>





        </div>

        <!-- Player Selection -->
        <div class="col-md-4">
            <div class="bg-white p-4 rounded shadow-sm">
                <h5 class="fw-bold">Player Selection</h5>
                <!-- <input type="text" class="form-control mb-3" placeholder="Search for player...">
                <select class="form-select mb-3">
                    <option>View</option>
                    <option>Defenders</option>
                    <option>Midfielders</option>
                </select>
                <select class="form-select mb-3">
                    <option>Sorted by</option>
                    <option>Total points</option>
                    <option>Price</option>
                </select>
                <p class="fw-bold mb-1">Max cost: Between 3.9 and 7.2</p>
                <div class="d-flex justify-content-between">
                    <span>7.2</span>
                    <input type="range" class="form-range">
                </div>
                <div class="form-check mt-3">
                    <input class="form-check-input" type="checkbox" id="fiveSeasons">
                    <label class="form-check-label" for="fiveSeasons">
                        Show Players who have been at their club for 5+ seasons
                    </label>
                </div> -->
                <button id="playerCountButton" class="btn btn-primary w-100 mt-3">0 players shown</button>

                <!-- Goalkeepers Section -->
                <h5 class="fw-bold text-dark mt-4">Goalkeepers</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <!-- <th>Position</th> -->
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody id="goalkeepersTableBody">
                        <tr>
                            <td colspan="4" class="text-center">Select a team to view players.</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Defenders Section -->
                <h5 class="fw-bold text-dark mt-4">Defenders</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <!-- <th>Position</th> -->
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody id="defendersTableBody">
                        <tr>
                            <td colspan="4" class="text-center">Select a team to view players.</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Midfielders Section -->
                <h5 class="fw-bold text-dark mt-4">Midfielders</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <!-- <th>Position</th> -->
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody id="midfieldersTableBody">
                        <tr>
                            <td colspan="4" class="text-center">Select a team to view players.</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Forwards Section -->
                <h5 class="fw-bold text-dark mt-4">Forwards</h5>
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Player</th>
                            <!-- <th>Position</th> -->
                            <th>Points</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody id="forwardsTableBody">
                        <tr>
                            <td colspan="4" class="text-center">Select a team to view players.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Auto Pitch -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Define formations and their respective positions
            const formations = {
                "1-1-2": [
                    { position: "Goalkeeper", top: "10%", left: "50%" },
                    { position: "Defender", top: "45%", left: "50%" },
                    { position: "Midfielder", top: "77%", left: "32%" },
                    { position: "Midfielder", top: "77%", left: "67%" },
                ],
                "4-4-2": [
                    { position: "Goalkeeper", top: "10%", left: "50%" },
                    { position: "Defender", top: "25%", left: "20%" },
                    { position: "Defender", top: "25%", left: "40%" },
                    { position: "Defender", top: "25%", left: "60%" },
                    { position: "Defender", top: "25%", left: "80%" },
                    { position: "Midfielder", top: "50%", left: "20%" },
                    { position: "Midfielder", top: "50%", left: "40%" },
                    { position: "Midfielder", top: "50%", left: "60%" },
                    { position: "Midfielder", top: "50%", left: "80%" },
                    { position: "Forward", top: "77%", left: "32%" },
                    { position: "Forward", top: "77%", left: "67%" },
                ],
            };

            // Define available players with prices
            const players = [
                { name: "Aaron Ramsdale", position: "Goalkeeper", price: 4.5, image: "{% static 'images/m_salah.png' %}" },
                { name: "David Raya", position: "Goalkeeper", price: 4.8, image: "{% static 'images/m_salah.png' %}" },
                { name: "Ben White", position: "Defender", price: 5.0, image: "{% static 'images/m_salah.png' %}" },
                { name: "William Saliba", position: "Defender", price: 5.5, image: "{% static 'images/m_salah.png' %}" },
                { name: "Oleksandr Zinchenko", position: "Defender", price: 5.2, image: "{% static 'images/m_salah.png' %}" },
                { name: "Gabriel Magalhaes", position: "Defender", price: 5.0, image: "{% static 'images/m_salah.png' %}" },
                { name: "Martin Degaard", position: "Midfielder", price: 6.8, image: "{% static 'images/m_salah.png' %}" },
                { name: "Declan Rice", position: "Midfielder", price: 5.9, image: "{% static 'images/m_salah.png' %}" },
                { name: "Bukayo Saka", position: "Forward", price: 8.3, image: "{% static 'images/m_salah.png' %}" },
                { name: "Gabriel Jesus", position: "Forward", price: 8.0, image: "{% static 'images/m_salah.png' %}" },
            ];

            const formationSelect = document.getElementById("formation-select");
            const pitchFormation = document.getElementById("pitch-formation");
            const autoPickButton = document.getElementById("autoPickButton");
            const budgetDisplay = document.getElementById("budgetDisplay");

            let totalBudget = 100.0; // Total available budget
            let remainingBudget = totalBudget; // Remaining budget

            // Update the budget display
            function updateBudgetDisplay() {
                budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
            }

            // Function to render a formation
            function renderFormation(formationKey) {
                pitchFormation.innerHTML = ""; // Clear the pitch
                const formation = formations[formationKey];

                if (formation) {
                    formation.forEach((position) => {
                        const positionDiv = document.createElement("div");
                        positionDiv.className = "position-absolute text-center";
                        positionDiv.style.top = position.top;
                        positionDiv.style.left = position.left;
                        positionDiv.style.transform = "translate(-50%, -50%)";
                        positionDiv.innerHTML = `
                    <div class="bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center" 
                        style="width: 50px; height: 50px;">
                        ${position.position}
                    </div>
                `;
                        pitchFormation.appendChild(positionDiv);
                    });
                }
            }

            // Auto-pick players while considering the budget
            function autoPickPlayers(formationKey) {
                const formation = formations[formationKey];
                if (!formation) {
                    console.error("Formation not found:", formationKey);
                    return;
                }

                const shuffledPlayers = [...players].sort(() => 0.5 - Math.random());
                remainingBudget = totalBudget; // Reset budget
                updateBudgetDisplay(); // Update budget display
                pitchFormation.innerHTML = ""; // Clear the pitch

                formation.forEach((position) => {
                    const player = shuffledPlayers.find((p) => p.position === position.position && p.price <= remainingBudget);
                    if (player) {
                        const playerDiv = document.createElement("div");
                        playerDiv.className = "position-absolute text-center";
                        playerDiv.style.top = position.top;
                        playerDiv.style.left = position.left;
                        playerDiv.style.transform = "translate(-50%, -50%)";

                        playerDiv.innerHTML = `
                        <div class="rounded text-center shadow-sm player-card" 
                            style="width: 50px;  font-family: Arial, sans-serif; cursor: pointer;"  
                            data-name="${player.name}" 
                            data-image="${player.image}" 
                            data-position="${player.position}" 
                            data-price="${player.price}">

                            <div class="bg-success d-flex justify-content-center align-items-center" style="padding-top: 5px;border-top-left-radius: 10px; border-top-right-radius: 10px; padding: 5px;">
                                <img src="${player.image}" alt="${player.name.split(" ")[0]}" 
                                    style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                            </div>

                            <div class="bg-light" 
                                style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                                ${player.name.split(" ")[0]}
                            </div>

                        </div>
                    `;

                        // Add click event to open the modal
                        playerDiv.querySelector(".player-card").addEventListener("click", function () {
                            showPlayerModal(
                                this.getAttribute("data-name"),
                                this.getAttribute("data-image"),
                                this.getAttribute("data-position")
                            );
                        });

                        pitchFormation.appendChild(playerDiv);

                        // Deduct the player's price from the budget
                        remainingBudget -= player.price;
                        updateBudgetDisplay();
                    }
                });
            }

            function showPlayerModal(name, image, position) {
                const modal = document.getElementById("playerModal");
                document.getElementById("modalPlayerName").textContent = name;
                document.getElementById("modalPlayerImage").src = image;
                document.getElementById("modalPlayerPosition").textContent = position;
                modal.style.display = "block";
            }

            document.getElementById("closeModalButton").addEventListener("click", function () {
                document.getElementById("playerModal").style.display = "none";
            });

            document.getElementById("playerModal").addEventListener("click", function (e) {
                if (e.target === this) {
                    this.style.display = "none";
                }
            });

            // Event listener for formation dropdown change
            formationSelect.addEventListener("change", function () {
                renderFormation(this.value);
            });

            // Event listener for Auto-Pick button
            autoPickButton.addEventListener("click", function () {
                autoPickPlayers(formationSelect.value); // Trigger auto-pick based on the current formation
            });

            // Render default formation on load
            renderFormation("1-1-2");
            updateBudgetDisplay(); // Initialize budget display
        });

    </script>

    <!-- Manual $ Reset -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const formations = {
                "1-1-2": [
                    { position: "Goalkeeper", top: "10%", left: "50%" },
                    { position: "Defender", top: "45%", left: "50%" },
                    { position: "Midfielder", top: "77%", left: "32%" },
                    { position: "Midfielder", top: "77%", left: "67%" },
                ],
                "4-4-2": [
                    { position: "Goalkeeper", top: "10%", left: "50%" },
                    { position: "Defender", top: "25%", left: "20%" },
                    { position: "Defender", top: "25%", left: "40%" },
                    { position: "Defender", top: "25%", left: "60%" },
                    { position: "Defender", top: "25%", left: "80%" },
                    { position: "Midfielder", top: "50%", left: "20%" },
                    { position: "Midfielder", top: "50%", left: "40%" },
                    { position: "Midfielder", top: "50%", left: "60%" },
                    { position: "Midfielder", top: "50%", left: "80%" },
                    { position: "Forward", top: "77%", left: "32%" },
                    { position: "Forward", top: "77%", left: "67%" },
                ],
            };

            const pitchFormation = document.getElementById("pitch-formation");
            const formationSelect = document.getElementById("formation-select");
            const resetButton = document.getElementById("resetButton");
            const playerSelectionRows = document.querySelectorAll(".player-selection-row");

            const maxBudget = 100; // Example budget in millions
            let remainingBudget = maxBudget; // Track the remaining budget
            let currentTotalPrice = 0; // Track the total price of added players

            let selectedPositionElement = null; // Track the currently selected position

            // Function to render a formation
            function renderFormation(formationKey) {
                pitchFormation.innerHTML = ""; // Clear the pitch
                const formation = formations[formationKey];

                if (formation) {
                    formation.forEach((position, index) => {
                        const positionDiv = document.createElement("div");
                        positionDiv.className = "pitch-position position-absolute text-center";
                        positionDiv.style.top = position.top;
                        positionDiv.style.left = position.left;
                        positionDiv.style.transform = "translate(-50%, -50%)";
                        positionDiv.setAttribute("data-index", index);

                        positionDiv.innerHTML = `
                    <div class="bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center" 
                        style="width: 50px; height: 50px; cursor: pointer;">
                        ${position.position}
                    </div>
                `;

                        // Event listener for manual assignment
                        positionDiv.addEventListener("click", function () {
                            selectedPositionElement = positionDiv; // Store the clicked position
                            highlightPosition(selectedPositionElement);
                        });

                        pitchFormation.appendChild(positionDiv);
                    });
                }
            }

            // Highlight the selected position
            function highlightPosition(positionDiv) {
                document.querySelectorAll(".pitch-position").forEach((div) => {
                    div.style.border = ""; // Reset border for all positions
                });
                if (positionDiv) {
                    positionDiv.style.border = "2px dashed green"; // Highlight the selected position Remaining Budget: Ksh
                }
            }

            // Update the displayed budget
            function updateBudgetDisplay() {
                const budgetDisplay = document.getElementById("budgetDisplay");
                budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
            }

            // Assign a player to the selected position
            function assignPlayerToPosition(player, price) {
                if (!selectedPositionElement) {
                    showToast("Please select a position on the pitch first!", "danger");
                    return;
                }

                if (price > remainingBudget) {
                    showToast("Insufficient budget to add this player!", "danger");
                    return;
                }

                if (currentTotalPrice + price > maxBudget) {
                    showToast("Adding this player exceeds the total budget!", "danger");
                    return;
                }

                // Deduct the player's price from the remaining budget and add to the total price
                remainingBudget -= price;
                currentTotalPrice += price;
                updateBudgetDisplay();

                selectedPositionElement.innerHTML = `
            <div class="rounded text-center shadow-sm player-card" 
                style="width: 50px; font-family: Arial, sans-serif; cursor: pointer;"
                data-name="${player.name}"
                data-image="${player.image}"
                data-position="${player.position}"
                data-price="${price}">

                <div class="bg-success d-flex justify-content-center align-items-center" 
                    style="padding: 5px; border-top-left-radius: 10px; border-top-right-radius: 10px;">
                    <img src="${player.image}" alt="${player.name}" 
                        style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                </div>
                <div class="bg-light" 
                    style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; 
                    border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                    ${player.name.split(" ")[0]}
                </div>
            </div>
        `;

                // Add click event to the new player card for modal functionality
                selectedPositionElement.querySelector(".player-card").addEventListener("click", function (e) {
                    e.stopPropagation(); // Prevent event bubbling
                    showPlayerModal(player.name, player.image, player.position);
                });

                highlightPosition(null); // Reset the highlight
                selectedPositionElement = null; // Clear selected position
            }

            // Show modal with player details
            function showPlayerModal(name, image, position) {
                const modal = document.getElementById("playerModal");
                document.getElementById("modalPlayerName").textContent = name;
                document.getElementById("modalPlayerImage").src = image;
                document.getElementById("modalPlayerPosition").textContent = position;
                modal.style.display = "block";
            }

            // Close the modal
            document.getElementById("closeModalButton").addEventListener("click", function () {
                document.getElementById("playerModal").style.display = "none";
            });

            document.getElementById("playerModal").addEventListener("click", function (e) {
                if (e.target === this) {
                    this.style.display = "none";
                }
            });

            // Attach event listeners to player selection rows
            playerSelectionRows.forEach((row) => {
                row.addEventListener("click", function () {
                    const player = {
                        name: this.getAttribute("data-name"),
                        image: this.getAttribute("data-image"),
                        position: this.getAttribute("data-position"),
                    };

                    const priceText = this.querySelector("td:nth-child(4)").textContent.trim(); // Extract price from 4th column
                    const price = parseFloat(priceText.replace("m", ""));

                    assignPlayerToPosition(player, price);
                });
            });

            // Reset button event listener
            resetButton.addEventListener("click", function () {
                renderFormation(formationSelect.value); // Re-render formation without players
                remainingBudget = maxBudget; // Reset budget
                currentTotalPrice = 0; // Reset total price
                updateBudgetDisplay();
            });

            // Event listener for formation dropdown change
            formationSelect.addEventListener("change", function () {
                renderFormation(this.value);
            });

            // Render default formation on load
            renderFormation("1-1-2");

            // Initialize budget display
            updateBudgetDisplay();
        });

    </script>

    <!-- Showing Toast -->
    <script>
        function showToast(message, type = "danger") {
            const toastContainer = document.getElementById("toastContainer");

            // Create the toast element
            const toast = document.createElement("div");
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.setAttribute("role", "alert");
            toast.setAttribute("aria-live", "assertive");
            toast.setAttribute("aria-atomic", "true");
            toast.setAttribute("data-bs-autohide", "true");
            toast.setAttribute("data-bs-delay", "3000");

            // Add the toast content
            toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    `;

            // Append the toast to the container
            toastContainer.appendChild(toast);

            // Initialize the toast using Bootstrap's JS
            const bootstrapToast = new bootstrap.Toast(toast);
            bootstrapToast.show();

            // Remove the toast from the DOM after it hides
            toast.addEventListener("hidden.bs.toast", () => {
                toast.remove();
            });
        }

    </script>

    <!-- Team Saving -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const saveTeamButton = document.getElementById("saveTeamButton");

            // Fetch team status on page load
            fetch("/api/check-team-status/", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                },
            })
                .then((response) => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error("Failed to fetch team status.");
                })
                .then((data) => {
                    if (data.team_exists) {
                        // Disable the save button if the team already exists
                        saveTeamButton.disabled = true;
                        saveTeamButton.textContent = "Team Saved";
                        saveTeamButton.classList.add("btn-secondary"); // Optional: Update button styling
                        saveTeamButton.classList.remove("btn-primary");

                        // Disable the Auto Pick and Reset buttons
                        autoPickButton.disabled = true;
                        autoPickButton.classList.add("btn-secondary"); // Optional: Update styling
                        autoPickButton.classList.remove("btn-outline-secondary");

                        resetButton.disabled = true;
                        resetButton.classList.add("btn-secondary"); // Optional: Update styling
                        resetButton.classList.remove("btn-outline-secondary");
                    }
                })
                .catch((error) => {
                    console.error("Error fetching team status:", error);
                });

            // Save Team Button Event Listener
            saveTeamButton.addEventListener("click", function () {
                const pitchPositions = document.querySelectorAll(".position-absolute .player-card");
                const teamData = [];
                const teamName = document.getElementById("teamName").textContent.trim();

                pitchPositions.forEach((playerCard) => {
                    if (playerCard) {
                        const positionContainer = playerCard.parentElement; // Get parent container (position-absolute)
                        const positionCoordinates = {
                            top: positionContainer.style.top,
                            left: positionContainer.style.left,
                        };

                        const playerData = {
                            name: playerCard.getAttribute("data-name"),
                            position: playerCard.getAttribute("data-position"),
                            team: playerCard.getAttribute("data-team") || "Unknown",
                            formation_name: document.getElementById("formation-select").value,
                            score: parseInt(playerCard.getAttribute("data-score") || "0"),
                            position_coordinates: JSON.stringify(positionCoordinates), // Add coordinates as JSON string
                        };
                        teamData.push(playerData);
                    }
                });


                if (teamData.length === 0) {
                    showToast("No players selected to save.", "danger");
                    return;
                }

                // Send the team data to the backend
                fetch("/api/save-team/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": getCSRFToken(),
                    },
                    body: JSON.stringify({ team_name: teamName, team: teamData }), // Ensure payload matches backend expectation
                })
                    .then((response) => {
                        // console.log("Response status:", response.status); // Debug log
                        if (response.ok) {
                            return response.json();
                        }
                        throw new Error("Failed to save team.");
                    })
                    .then((data) => {
                        // Show success toast and disable button
                        showToast(data.message || "Team saved successfully!", "success");
                        saveTeamButton.disabled = true;
                        saveTeamButton.textContent = "Team Saved";
                        saveTeamButton.classList.add("btn-secondary");
                        saveTeamButton.classList.remove("btn-primary");

                        // Disable the Auto Pick and Reset buttons
                        autoPickButton.disabled = true;
                        autoPickButton.classList.add("btn-secondary"); // Optional: Update styling
                        autoPickButton.classList.remove("btn-outline-secondary");

                        resetButton.disabled = true;
                        resetButton.classList.add("btn-secondary"); // Optional: Update styling
                        resetButton.classList.remove("btn-outline-secondary");

                        // Show the modal
                        const leagueOptionsModal = new bootstrap.Modal(document.getElementById("leagueOptionsModal"));
                        leagueOptionsModal.show();

                        // Redirect to a new page after success
                        // window.location.href = "/api/manageteam/"; 
                    })
                    .catch((error) => {
                        console.error(error);
                        showToast("Error saving team. Please try again.", "danger");
                    });
            });

            const dismissButton = document.getElementById("dismissButton");

            dismissButton.addEventListener("click", function () {
                // Redirect to /api/manageteam/
                window.location.href = "/api/manageteam/";
            });


            // Helper function to get CSRF token
            function getCSRFToken() {
                const csrfTokenElement = document.querySelector('[name=csrfmiddlewaretoken]');
                return csrfTokenElement ? csrfTokenElement.value : "";
            }

            // Helper function to show toast messages
            function showToast(message, type) {
                const toastContainer = document.getElementById("toastContainer");
                if (!toastContainer) {
                    console.error("Toast container not found.");
                    return;
                }

                const toast = document.createElement("div");
                toast.className = `toast align-items-center text-white bg-${type} border-0`;
                toast.role = "alert";
                toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
                toastContainer.appendChild(toast);

                const bootstrapToast = new bootstrap.Toast(toast);
                bootstrapToast.show();

                toast.addEventListener("hidden.bs.toast", () => {
                    toastContainer.removeChild(toast);
                });
            }

        });
    </script>

    <!-- Get the saved players -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const pitchFormation = document.getElementById("pitch-formation");
            const budgetDisplay = document.getElementById("budgetDisplay");
            const totalBudget = 100.0; // Initial budget

            // Function to update the budget display
            function updateBudgetDisplay(remainingBudget) {
                budgetDisplay.textContent = `${remainingBudget.toFixed(1)}m`;
            }

            // Function to render saved players on the pitch
            function renderSavedPlayers(savedTeam) {
                pitchFormation.innerHTML = ""; // Clear the pitch
                let totalPlayerPrice = 0;

                savedTeam.forEach((player) => {
                    const positionDiv = document.createElement("div");
                    positionDiv.className = "position-absolute text-center";
                    positionDiv.style.transform = "translate(-50%, -50%)";

                    // Parse the position coordinates from the data
                    const coordinates = JSON.parse(player.position_coordinates || "{}");
                    positionDiv.style.top = coordinates.top;
                    positionDiv.style.left = coordinates.left;

                    positionDiv.innerHTML = `
                    <div class="rounded text-center shadow-sm player-card" 
                        style="width: 50px; font-family: Arial, sans-serif; cursor: pointer;"  
                        data-name="${player.name}" 
                        data-position="${player.position}" 
                        data-price="${player.price}" 
                        data-image="${player.image || '{% static "images/m_salah.png" %}'}">

                        <div class="bg-success d-flex justify-content-center align-items-center" 
                            style="padding: 5px; border-top-left-radius: 10px; border-top-right-radius: 10px;">
                            <img src="${player.image || '{% static "images/m_salah.png" %}'}" alt="${player.name}" 
                                style="width: 30px; height: 30px; border-radius: 5px; object-fit: cover;">
                        </div>

                        <div class="bg-light" 
                            style="font-size: 0.6rem; font-weight: bold; color: #4A4A4A; margin-bottom: 2px; 
                            border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                            ${player.name.split(" ")[0]}
                        </div>
                    </div>
                `;

                    // Attach click event listener to open modal
                    positionDiv.querySelector(".player-card").addEventListener("click", function () {
                        const name = this.getAttribute("data-name");
                        const image = this.getAttribute("data-image");
                        const position = this.getAttribute("data-position");

                        showPlayerModal(name, image, position);
                    });

                    pitchFormation.appendChild(positionDiv);

                    // Add the player's price to the total
                    totalPlayerPrice += parseFloat(player.price) || 0;
                });
                // Calculate remaining budget and update the display
                const remainingBudget = totalBudget - totalPlayerPrice;
                updateBudgetDisplay(remainingBudget);
                console.log(totalPlayerPrice)
            }

            // Fetch saved players and render them on the pitch
            fetch("/api/get-saved-team/", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                },
            })
                .then((response) => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error("Failed to fetch saved team.");
                })
                .then((data) => {
                    if (data.team && data.team.length > 0) {
                        renderSavedPlayers(data.team); // Render players
                    }
                })
                .catch((error) => {
                    console.error("Error loading saved team:", error);
                });

            // Function to show modal with player details
            function showPlayerModal(name, image, position) {
                const modal = document.getElementById("playerModal");
                document.getElementById("modalPlayerName").textContent = name;
                document.getElementById("modalPlayerImage").src = image || "default-image.png"; // Fallback if no image
                document.getElementById("modalPlayerPosition").textContent = position || "Unknown";
                modal.style.display = "block";
            }

            // Close the modal
            document.getElementById("closeModalButton").addEventListener("click", function () {
                document.getElementById("playerModal").style.display = "none";
            });

            document.getElementById("playerModal").addEventListener("click", function (e) {
                if (e.target === this) {
                    this.style.display = "none";
                }
            });
        });
    </script>

    <!-- Load Player to table -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const teamSelect = document.getElementById("teamSelect");
            const playerCountButton = document.getElementById("playerCountButton");  
            const favoriteClubId = "{{ favorite_club_id }}"; // Pass from the backend

            const positions = ["goalkeepers", "defenders", "midfielders", "forwards"];
            const tableBodies = {
                Goalkeepers: document.getElementById("goalkeepersTableBody"),
                Defenders: document.getElementById("defendersTableBody"),
                Midfielders: document.getElementById("midfieldersTableBody"),
                Forwards: document.getElementById("forwardsTableBody"),
            };

            // Fetch and populate teams
            fetch("/api/get-teams/")
                .then((response) => response.json())
                .then((data) => {
                    if (data.teams) {
                        data.teams.forEach((team) => {
                            const option = document.createElement("option");
                            option.value = team.id;
                            option.textContent = team.name;
                            teamSelect.appendChild(option);
                        });
                    }
                })
                .catch((error) => console.error("Error fetching teams:", error));

            // Fetch and display players
            // teamSelect.addEventListener("change", function () {
                // console.log("Favorite Club ID:", favoriteClubId); // Debugging
                //const teamId = teamSelect.value;
               
               
               
               
               
                const teamId = favoriteClubId;

                // Clear all player tables
                Object.keys(tableBodies).forEach((position) => {
                    tableBodies[position].innerHTML = `
                <tr>
                    <td colspan="4" class="text-center">Loading players...</td>
                </tr>
            `;
                });

                playerCountButton.textContent = "Loading players...";

                // Fetch players for the selected team
                fetch(`/api/get-players-by-team/?team_id=${teamId}`)
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.players) {
                            let playerCount = 0; // Initialize player count
                            
                            Object.keys(tableBodies).forEach((position) => {
                                tableBodies[position].innerHTML = ""; // Clear loading rows
                            });

                            data.players.forEach((player) => {
                                playerCount++;
                                const row = `
                            <tr  class="player-selection-row" data-name="${player.name}"
                                    data-image="${player.image}" data-position="${player.position}">
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="${player.image}" 
                                             alt="${player.name}" 
                                             class="me-3 rounded-circle" 
                                             style="width: 40px;"
                                             onerror="this.onerror=null; this.src='/static/images/home_team.png';">
                                        <div>
                                            <span class="fw-bold">${player.name}</span><br>
                                        </div>
                                    </div>
                                </td>
                                
                                <td class="fw-bold text-center">${player.total_points}</td>
                                <td class="fw-bold text-center">${player.price}m</td>
                               
                            </tr>
                        `;

                                const tableBody = tableBodies[player.position];
                                if (tableBody) {
                                    tableBody.innerHTML += row;
                                    // <td>${player.position}</td> 
                                }
                            });
                            playerCountButton.textContent = `${playerCount} players shown`;
                        } else {
                            Object.keys(tableBodies).forEach((position) => {
                                tableBodies[position].innerHTML = `
                            <tr>
                                <td colspan="4" class="text-center">No players found for this team.</td>
                            </tr>
                        `;
                            });
                            playerCountButton.textContent = "0 players shown";
                        }
                    })
                    .catch((error) => {
                        console.error("Error fetching players:", error);
                        Object.keys(tableBodies).forEach((position) => {
                            tableBodies[position].innerHTML = `
                        <tr>
                            <td colspan="4" class="text-center text-danger">Failed to load players.</td>
                        </tr>
                    `;
                        });
                        playerCountButton.textContent = "Failed to load players";
                    });

            // });
        });

    </script>
    {% endblock %}






























    <!-- Add the fixtures section below -->
    <div class="mt-4 bg-light rounded p-3">
        <h4 class="text-center fw-bold text-uppercase mb-3">Gameweek 21 Fixtures</h4>
        <p class="text-center text-muted">Final Deadline <strong>Thu 16 Jan 23:00</strong></p>
        <div class="text-center mb-3">
            <button class="btn btn-primary">Deadlines explained</button>
        </div>
        <h5 class="fw-bold text-dark">Tuesday 14 January 2025</h5>
        <div class="timeline mt-3">
            <!-- Match 1 -->
            <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                <div class="me-2 text-center">
                    <span class="fw-bold">22:30</span>
                    <p class="text-muted small">Next deadline</p>
                </div>
                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                    <div class="d-flex align-items-center me-3">
                        <img src="{% static 'images/brentford.png' %}" alt="Brentford" class="img-fluid"
                            style="height: 24px; width: 24px; margin-right: 8px;">
                        <span>Brentford</span>
                    </div>
                    <span class="fw-bold mx-3">22:30</span>
                    <div class="d-flex align-items-center ms-3">
                        <span>Man City</span>
                        <img src="{% static 'images/man_city.png' %}" alt="Man City" class="img-fluid"
                            style="height: 24px; width: 24px; margin-left: 8px;">
                    </div>
                </div>
                <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                    style="height: 24px;">
            </div>

            <!-- Match 2 -->
            <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                <div class="me-2 text-center">
                    <span class="fw-bold">22:30</span>
                    <p class="text-muted small">Next deadline</p>
                </div>
                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                    <div class="d-flex align-items-center me-3">
                        <img src="{% static 'images/chelsea.png' %}" alt="Chelsea" class="img-fluid"
                            style="height: 24px; width: 24px; margin-right: 8px;">
                        <span>Chelsea</span>
                    </div>
                    <span class="fw-bold mx-3">22:30</span>
                    <div class="d-flex align-items-center ms-3">
                        <span>Bournemouth</span>
                        <img src="{% static 'images/bournemouth.png' %}" alt="Bournemouth" class="img-fluid"
                            style="height: 24px; width: 24px; margin-left: 8px;">
                    </div>
                </div>
                <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                    style="height: 24px;">
            </div>

            <!-- Match 3 -->
            <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                <div class="me-2 text-center">
                    <span class="fw-bold">22:30</span>
                    <p class="text-muted small">Next deadline</p>
                </div>
                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                    <div class="d-flex align-items-center me-3">
                        <img src="{% static 'images/west_ham.png' %}" alt="West Ham" class="img-fluid"
                            style="height: 24px; width: 24px; margin-right: 8px;">
                        <span>West Ham</span>
                    </div>
                    <span class="fw-bold mx-3">22:30</span>
                    <div class="d-flex align-items-center ms-3">
                        <span>Fulham</span>
                        <img src="{% static 'images/fulham.png' %}" alt="Fulham" class="img-fluid"
                            style="height: 24px; width: 24px; margin-left: 8px;">
                    </div>
                </div>
                <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                    style="height: 24px;">
            </div>

            <!-- Match 4 -->
            <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                <div class="me-2 text-center">
                    <span class="fw-bold">22:30</span>
                    <p class="text-muted small">Next deadline</p>
                </div>
                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                    <div class="d-flex align-items-center me-3">
                        <img src="{% static 'images/nottm_forest.png' %}" alt="Nott'm Forest" class="img-fluid"
                            style="height: 24px; width: 24px; margin-right: 8px;">
                        <span>Nott'm Forest</span>
                    </div>
                    <span class="fw-bold mx-3">22:30</span>
                    <div class="d-flex align-items-center ms-3">
                        <span>Liverpool</span>
                        <img src="{% static 'images/liverpool.png' %}" alt="Liverpool" class="img-fluid"
                            style="height: 24px; width: 24px; margin-left: 8px;">
                    </div>
                </div>
                <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                    style="height: 24px;">
            </div>

            <!-- Match 5 -->
            <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                <div class="me-2 text-center">
                    <span class="fw-bold">22:30</span>
                    <p class="text-muted small">Next deadline</p>
                </div>
                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                    <div class="d-flex align-items-center me-3">
                        <img src="{% static 'images/everton.png' %}" alt="Everton" class="img-fluid"
                            style="height: 24px; width: 24px; margin-right: 8px;">
                        <span>Everton</span>
                    </div>
                    <span class="fw-bold mx-3">22:30</span>
                    <div class="d-flex align-items-center ms-3">
                        <span>Aston Villa</span>
                        <img src="{% static 'images/aston_villa.png' %}" alt="Aston Villa" class="img-fluid"
                            style="height: 24px; width: 24px; margin-left: 8px;">
                    </div>
                </div>
                <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                    style="height: 24px;">
            </div>

            <!-- Match 6 -->
            <div class="d-flex align-items-center mb-3 bg-white rounded p-2 shadow-sm">
                <div class="me-2 text-center">
                    <span class="fw-bold">22:30</span>
                    <p class="text-muted small">Next deadline</p>
                </div>
                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                    <div class="d-flex align-items-center me-3">
                        <img src="{% static 'images/leicester.png' %}" alt="Leicester" class="img-fluid"
                            style="height: 24px; width: 24px; margin-right: 8px;">
                        <span>Leicester</span>
                    </div>
                    <span class="fw-bold mx-3">22:30</span>
                    <div class="d-flex align-items-center ms-3">
                        <span>Crystal Palace</span>
                        <img src="{% static 'images/crystal_palace.png' %}" alt="Crystal Palace"
                            class="img-fluid" style="height: 24px; width: 24px; margin-left: 8px;">
                    </div>
                </div>
                <img src="{% static 'images/sponsor-logo.png' %}" alt="Sponsor" class="ms-3"
                    style="height: 24px;">
            </div>
        </div>
    </div>